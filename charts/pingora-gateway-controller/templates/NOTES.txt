Pingora Gateway Controller installed successfully!

Release: {{ .Release.Name }}
Namespace: {{ .Release.Namespace }}
Chart Version: {{ .Chart.Version }}
App Version: {{ .Chart.AppVersion }}

Next Steps:

1. Verify deployment status:
   kubectl get pods -n {{ .Release.Namespace }} -l app.kubernetes.io/instance={{ .Release.Name }}

2. Check controller logs:
   kubectl logs -n {{ .Release.Namespace }} -l app.kubernetes.io/name={{ include "pingora-gw-ctrl.name" . }} --follow

3. Verify GatewayClass is created:
   kubectl get gatewayclass {{ .Values.controller.gatewayClassName }}

4. Create a Gateway resource:
   cat <<EOF | kubectl apply -f -
   apiVersion: gateway.networking.k8s.io/v1
   kind: Gateway
   metadata:
     name: pingora-gateway
     namespace: {{ .Release.Namespace }}
   spec:
     gatewayClassName: {{ .Values.controller.gatewayClassName }}
     listeners:
       - name: http
         protocol: HTTP
         port: 80
   EOF

5. Create an HTTPRoute to expose your service:
   cat <<EOF | kubectl apply -f -
   apiVersion: gateway.networking.k8s.io/v1
   kind: HTTPRoute
   metadata:
     name: my-app
     namespace: {{ .Release.Namespace }}
   spec:
     parentRefs:
       - name: pingora-gateway
     hostnames:
       - "app.example.com"
     rules:
       - backendRefs:
           - name: my-app-service
             port: 80
   EOF

{{- if .Values.proxy.enabled }}

Pingora Proxy:
  The proxy is deployed and listening on:
    - HTTP traffic: port 8080
    - Health endpoints: port 9090 (/healthz, /readyz)
    - gRPC API: port 50051

  Verify proxy deployment:
    kubectl get pods -n {{ .Release.Namespace }} -l app.kubernetes.io/component=proxy

  Check proxy logs:
    kubectl logs -n {{ .Release.Namespace }} -l app.kubernetes.io/component=proxy --follow
{{- end }}

{{- if .Values.pingoraConfig.create }}

PingoraConfig:
  {{- if .Values.proxy.enabled }}
  Configuration auto-generated to connect to the deployed proxy.
  {{- else }}
  Important: Ensure PingoraConfig has a valid Pingora proxy address.
  {{- end }}
  Verify configuration:
    kubectl get pingoraconfig {{ include "pingora-gw-ctrl.pingoraConfigName" . }}
{{- end }}

{{- if and (gt (.Values.replicaCount | int) 1) (not .Values.podDisruptionBudget.enabled) }}

High Availability: You are running {{ .Values.replicaCount }} replicas without PodDisruptionBudget.
Enable PDB for better availability during cluster maintenance:
  podDisruptionBudget:
    enabled: true
    minAvailable: 1
{{- end }}

{{- if not .Values.networkPolicy.enabled }}

Network Security: NetworkPolicy is disabled.
For production, enable NetworkPolicy to restrict traffic:
  networkPolicy:
    enabled: true
{{- end }}

Resources:
  Documentation: https://github.com/lexfrei/pingora-gateway-controller
  Issues: https://github.com/lexfrei/pingora-gateway-controller/issues
