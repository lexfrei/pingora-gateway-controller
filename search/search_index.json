{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Pingora Gateway Controller","text":"<p>Kubernetes controller implementing Gateway API for Pingora proxy.</p> <p>Route traffic through a high-performance Pingora-based reverse proxy using standard Gateway API resources (Gateway, HTTPRoute, GRPCRoute).</p>"},{"location":"#architecture","title":"Architecture","text":"<pre><code>graph TB\n    subgraph Kubernetes Cluster\n        GW[Gateway API Resources&lt;br/&gt;Gateway, HTTPRoute, GRPCRoute]\n        CTL[pingora-gateway-controller&lt;br/&gt;Go]\n        PX[pingora-proxy&lt;br/&gt;Rust/Pingora]\n        SVC[Backend Services]\n    end\n\n    CLIENT[Client Traffic] --&gt;|HTTP/gRPC| PX\n    GW --&gt;|watches| CTL\n    CTL --&gt;|gRPC sync| PX\n    PX --&gt;|proxies| SVC</code></pre>"},{"location":"#features","title":"Features","text":"<ul> <li>Standard Gateway API - GatewayClass, Gateway, HTTPRoute, GRPCRoute support</li> <li>High Performance - Built on Pingora, Cloudflare's battle-tested proxy framework</li> <li>Dynamic Configuration - Routes synced via gRPC without proxy restarts</li> <li>Leader Election - High availability deployments with multiple replicas</li> <li>Multi-arch Images - Supports amd64 and arm64 architectures</li> <li>Secure by Default - Non-root containers, read-only filesystem, minimal capabilities</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code># 1. Install Gateway API CRDs\nkubectl apply --filename https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.4.1/standard-install.yaml\n\n# 2. Install the controller with Helm\nhelm install pingora-gateway-controller \\\n  oci://ghcr.io/lexfrei/pingora-gateway-controller/chart \\\n  --namespace pingora-system \\\n  --create-namespace\n\n# 3. Create HTTPRoute to expose your service\nkubectl apply --filename - &lt;&lt;EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: my-app\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - app.example.com\n  rules:\n    - backendRefs:\n        - name: my-service\n          port: 80\nEOF\n</code></pre> <p>See Getting Started for detailed setup instructions.</p>"},{"location":"#documentation-sections","title":"Documentation Sections","text":"Section Description Getting Started Prerequisites, installation, and quick start guide Configuration Controller options, Helm values, PingoraConfig CRD Gateway API Supported resources, examples, and limitations Guides Cross-namespace routing, monitoring setup Operations Troubleshooting, metrics, and manual installation Development Architecture, contributing, and testing Reference Helm chart, CRD reference, security"},{"location":"#roadmap","title":"Roadmap","text":"<p>Target: Gateway API v1.4.1 Standard Channel Conformance</p>"},{"location":"#milestones","title":"Milestones","text":"Version Status Description v0.1.0  Planned Core Conformance (RequestHeaderModifier, RequestRedirect) v0.2.0  Planned Extended Features (ResponseHeaderModifier, URLRewrite, RequestMirror) v0.3.0  Planned Gateway API v1.4 (supportedFeatures, BackendTLSPolicy) v0.4.0  Planned Conformance Tests &amp; Registration v1.0.0  Planned Production-ready with full conformance"},{"location":"#gateway-api-support","title":"Gateway API Support","text":""},{"location":"#resources","title":"Resources","text":"Resource Status GatewayClass  Supported Gateway  Supported HTTPRoute  Supported GRPCRoute  Supported ReferenceGrant  Supported BackendTLSPolicy Planned"},{"location":"#httproute-filters","title":"HTTPRoute Filters","text":"Filter Conformance Status RequestHeaderModifier Core Planned RequestRedirect Core Planned ResponseHeaderModifier Extended Planned URLRewrite Extended Planned RequestMirror Extended Planned"},{"location":"#httproute-matching-implemented","title":"HTTPRoute Matching (Implemented)","text":"Feature Conformance Status Path (Exact, Prefix, Regex) Core  Supported Header matching Core  Supported Query parameter matching Extended  Supported Method matching Extended  Supported Backend weight Core  Supported Request timeout Extended  Supported <p>See GitHub Milestones for detailed progress.</p>"},{"location":"#project-links","title":"Project Links","text":"<ul> <li>GitHub Repository</li> <li>Issues</li> <li>Releases</li> </ul>"},{"location":"#license","title":"License","text":"<p>BSD 3-Clause License - see LICENSE for details.</p>"},{"location":"configuration/","title":"Configuration","text":"<p>This section covers all configuration options for the Pingora Gateway Controller.</p>"},{"location":"configuration/#overview","title":"Overview","text":"<p>Configuration is managed at three levels:</p> <ol> <li>Controller flags - Runtime behavior (logging, metrics, leader election)</li> <li>Helm values - Deployment configuration (replicas, resources, images)</li> <li>PingoraConfig CRD - Pingora proxy connection settings</li> </ol>"},{"location":"configuration/#sections","title":"Sections","text":"<ul> <li> <p> Controller Options</p> <p>CLI flags and environment variables for controller configuration.</p> <p> Controller Options</p> </li> <li> <p> Helm Values</p> <p>Complete reference for Helm chart values and customization.</p> <p> Helm Values</p> </li> <li> <p> PingoraConfig CRD</p> <p>Custom resource for configuring Pingora proxy connection.</p> <p> PingoraConfig</p> </li> </ul>"},{"location":"configuration/#configuration-hierarchy","title":"Configuration Hierarchy","text":"<pre><code>graph TD\n    subgraph Kubernetes Resources\n        GC[GatewayClass]\n        PC[PingoraConfig]\n    end\n\n    subgraph Helm Chart\n        HV[values.yaml]\n    end\n\n    subgraph Controller\n        CF[CLI Flags]\n        EV[Environment Variables]\n    end\n\n    HV --&gt;|generates| GC\n    HV --&gt;|generates| PC\n    GC --&gt;|parametersRef| PC\n    CF --&gt;|overrides| EV</code></pre>"},{"location":"configuration/#quick-reference","title":"Quick Reference","text":"Configuration Scope Reload CLI flags Controller Restart required Environment variables Controller Restart required Helm values Deployment <code>helm upgrade</code> PingoraConfig Proxy connection Dynamic (watch)"},{"location":"configuration/controller/","title":"Controller Options","text":"<p>The controller accepts configuration via CLI flags and environment variables.</p>"},{"location":"configuration/controller/#cli-flags","title":"CLI Flags","text":""},{"location":"configuration/controller/#core-flags","title":"Core Flags","text":"Flag Default Description <code>--gateway-class-name</code> <code>pingora</code> GatewayClass name to watch <code>--controller-name</code> <code>pingora.k8s.lex.la/gateway-controller</code> Controller identifier for GatewayClass <code>--cluster-domain</code> auto-detected Kubernetes cluster domain for DNS"},{"location":"configuration/controller/#observability-flags","title":"Observability Flags","text":"Flag Default Description <code>--metrics-addr</code> <code>:8080</code> Address for Prometheus metrics endpoint <code>--health-addr</code> <code>:8081</code> Address for health probe endpoints <code>--log-level</code> <code>info</code> Log level: <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code> <code>--log-format</code> <code>json</code> Log format: <code>json</code>, <code>text</code>"},{"location":"configuration/controller/#leader-election-flags","title":"Leader Election Flags","text":"Flag Default Description <code>--leader-elect</code> <code>false</code> Enable leader election for HA <code>--leader-election-namespace</code> controller namespace Namespace for leader election lease <code>--leader-election-name</code> <code>pingora-gateway-controller-leader</code> Name of the lease resource"},{"location":"configuration/controller/#environment-variables","title":"Environment Variables","text":"<p>All flags can be set via environment variables with <code>PINGORA_</code> prefix:</p> Environment Variable CLI Flag <code>PINGORA_GATEWAY_CLASS_NAME</code> <code>--gateway-class-name</code> <code>PINGORA_CONTROLLER_NAME</code> <code>--controller-name</code> <code>PINGORA_CLUSTER_DOMAIN</code> <code>--cluster-domain</code> <code>PINGORA_METRICS_ADDR</code> <code>--metrics-addr</code> <code>PINGORA_HEALTH_ADDR</code> <code>--health-addr</code> <code>PINGORA_LOG_LEVEL</code> <code>--log-level</code> <code>PINGORA_LOG_FORMAT</code> <code>--log-format</code> <code>PINGORA_LEADER_ELECT</code> <code>--leader-elect</code> <p>Precedence</p> <p>CLI flags take precedence over environment variables.</p>"},{"location":"configuration/controller/#cluster-domain-detection","title":"Cluster Domain Detection","text":"<p>The controller automatically detects the Kubernetes cluster domain from <code>/etc/resolv.conf</code> search domains. Override with <code>--cluster-domain</code> if:</p> <ul> <li>Auto-detection fails</li> <li>Using a non-standard cluster domain</li> <li>Running outside the cluster</li> </ul> <pre><code># Check auto-detected domain\nkubectl logs deployment/pingora-gateway-controller | grep \"cluster domain\"\n</code></pre>"},{"location":"configuration/controller/#health-endpoints","title":"Health Endpoints","text":"<p>The controller exposes health endpoints on <code>--health-addr</code>:</p> Endpoint Description <code>/healthz</code> Liveness probe - controller is running <code>/readyz</code> Readiness probe - controller can accept traffic"},{"location":"configuration/controller/#metrics-endpoint","title":"Metrics Endpoint","text":"<p>Prometheus metrics are exposed on <code>--metrics-addr</code>:</p> <pre><code>curl http://localhost:8080/metrics\n</code></pre> <p>See Metrics Reference for available metrics.</p>"},{"location":"configuration/controller/#example-full-configuration","title":"Example: Full Configuration","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: pingora-gateway-controller\nspec:\n  template:\n    spec:\n      containers:\n        - name: controller\n          args:\n            - --gateway-class-name=pingora\n            - --controller-name=pingora.k8s.lex.la/gateway-controller\n            - --metrics-addr=:8080\n            - --health-addr=:8081\n            - --log-level=debug\n            - --log-format=json\n            - --leader-elect=true\n            - --leader-election-namespace=pingora-system\n          env:\n            # Environment variables can also be used\n            - name: PINGORA_LOG_LEVEL\n              value: \"debug\"\n</code></pre>"},{"location":"configuration/controller/#next-steps","title":"Next Steps","text":"<ul> <li>Configure Helm Values for deployment customization</li> <li>Set up PingoraConfig for proxy connection</li> </ul>"},{"location":"configuration/gatewayclassconfig/","title":"PingoraConfig CRD","text":"<p>PingoraConfig is a cluster-scoped Custom Resource Definition (CRD) that configures the connection between the controller and Pingora proxy.</p>"},{"location":"configuration/gatewayclassconfig/#overview","title":"Overview","text":"<p>The PingoraConfig resource is referenced by GatewayClass via <code>parametersRef</code>:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: GatewayClass\nmetadata:\n  name: pingora\nspec:\n  controllerName: pingora.k8s.lex.la/gateway-controller\n  parametersRef:\n    group: pingora.k8s.lex.la\n    kind: PingoraConfig\n    name: pingora-config\n</code></pre>"},{"location":"configuration/gatewayclassconfig/#resource-definition","title":"Resource Definition","text":"<pre><code>apiVersion: pingora.k8s.lex.la/v1alpha1\nkind: PingoraConfig\nmetadata:\n  name: pingora-config\nspec:\n  # Required: gRPC endpoint address\n  address: \"pingora-proxy.pingora-system.svc.cluster.local:50051\"\n\n  # Optional: TLS configuration\n  tls:\n    enabled: false\n    secretRef:\n      name: pingora-tls\n      namespace: pingora-system\n    insecureSkipVerify: false\n    serverName: \"\"\n\n  # Optional: Connection parameters\n  connection:\n    connectTimeoutSeconds: 5\n    requestTimeoutSeconds: 30\n    keepaliveTimeSeconds: 30\n    maxRetries: 3\n    retryBackoffMs: 1000\n</code></pre>"},{"location":"configuration/gatewayclassconfig/#specification","title":"Specification","text":""},{"location":"configuration/gatewayclassconfig/#specaddress","title":"<code>spec.address</code>","text":"<p>Required. The gRPC endpoint address of the Pingora proxy.</p> Field Type Description <code>address</code> string Format: <code>host:port</code> <p>Example:</p> <pre><code>spec:\n  address: \"pingora-proxy.pingora-system.svc.cluster.local:50051\"\n</code></pre>"},{"location":"configuration/gatewayclassconfig/#spectls","title":"<code>spec.tls</code>","text":"<p>Optional TLS configuration for the gRPC connection.</p> Field Type Default Description <code>enabled</code> boolean <code>false</code> Enable TLS for gRPC connection <code>secretRef.name</code> string - Secret containing TLS certificates <code>secretRef.namespace</code> string - Namespace of the Secret <code>insecureSkipVerify</code> boolean <code>false</code> Skip certificate verification <code>serverName</code> string - Override server name for TLS <p>insecureSkipVerify</p> <p>Setting <code>insecureSkipVerify: true</code> disables certificate verification. Only use this for testing environments.</p>"},{"location":"configuration/gatewayclassconfig/#tls-secret-format","title":"TLS Secret Format","text":"<p>The referenced Secret must contain:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: pingora-tls\ntype: kubernetes.io/tls\ndata:\n  tls.crt: &lt;base64-encoded-certificate&gt;\n  tls.key: &lt;base64-encoded-key&gt;\n  ca.crt: &lt;base64-encoded-ca-certificate&gt;  # Optional\n</code></pre>"},{"location":"configuration/gatewayclassconfig/#specconnection","title":"<code>spec.connection</code>","text":"<p>Optional connection parameters for gRPC.</p> Field Type Default Description <code>connectTimeoutSeconds</code> int32 <code>5</code> Connection establishment timeout <code>requestTimeoutSeconds</code> int32 <code>30</code> Individual request timeout <code>keepaliveTimeSeconds</code> int32 <code>30</code> Keepalive ping interval <code>maxRetries</code> int32 <code>3</code> Maximum retry attempts <code>retryBackoffMs</code> int32 <code>1000</code> Backoff between retries (ms)"},{"location":"configuration/gatewayclassconfig/#status","title":"Status","text":"<p>The controller updates the PingoraConfig status:</p> <pre><code>status:\n  conditions:\n    - type: Ready\n      status: \"True\"\n      reason: Connected\n      message: \"Successfully connected to Pingora proxy\"\n  connected: true\n  lastSyncTime: \"2024-01-15T10:30:00Z\"\n  configVersion: 42\n</code></pre> Field Description <code>connected</code> Connection to proxy established <code>lastSyncTime</code> Last successful route sync <code>configVersion</code> Current configuration version"},{"location":"configuration/gatewayclassconfig/#examples","title":"Examples","text":""},{"location":"configuration/gatewayclassconfig/#basic-configuration","title":"Basic Configuration","text":"<p>Minimal configuration for in-cluster proxy:</p> <pre><code>apiVersion: pingora.k8s.lex.la/v1alpha1\nkind: PingoraConfig\nmetadata:\n  name: pingora-config\nspec:\n  address: \"pingora-proxy.pingora-system.svc.cluster.local:50051\"\n</code></pre>"},{"location":"configuration/gatewayclassconfig/#with-tls","title":"With TLS","text":"<p>Secure connection with mTLS:</p> <pre><code>apiVersion: pingora.k8s.lex.la/v1alpha1\nkind: PingoraConfig\nmetadata:\n  name: pingora-config\nspec:\n  address: \"pingora-proxy.pingora-system.svc.cluster.local:50051\"\n  tls:\n    enabled: true\n    secretRef:\n      name: controller-mtls\n      namespace: pingora-system\n    serverName: \"pingora-proxy\"\n</code></pre>"},{"location":"configuration/gatewayclassconfig/#custom-timeouts","title":"Custom Timeouts","text":"<p>For high-latency or unreliable networks:</p> <pre><code>apiVersion: pingora.k8s.lex.la/v1alpha1\nkind: PingoraConfig\nmetadata:\n  name: pingora-config\nspec:\n  address: \"pingora-proxy.remote-cluster.svc.cluster.local:50051\"\n  connection:\n    connectTimeoutSeconds: 10\n    requestTimeoutSeconds: 60\n    keepaliveTimeSeconds: 15\n    maxRetries: 5\n    retryBackoffMs: 2000\n</code></pre>"},{"location":"configuration/gatewayclassconfig/#troubleshooting","title":"Troubleshooting","text":""},{"location":"configuration/gatewayclassconfig/#connection-issues","title":"Connection Issues","text":"<p>Check PingoraConfig status:</p> <pre><code>kubectl get pingoraconfig pingora-config --output yaml\n</code></pre> <p>Verify proxy is reachable:</p> <pre><code>kubectl exec -it deployment/pingora-gateway-controller -- \\\n  nc -zv pingora-proxy.pingora-system.svc.cluster.local 50051\n</code></pre>"},{"location":"configuration/gatewayclassconfig/#tls-errors","title":"TLS Errors","text":"<p>Verify Secret exists and has correct keys:</p> <pre><code>kubectl get secret pingora-tls --namespace pingora-system --output yaml\n</code></pre> <p>Check certificate validity:</p> <pre><code>kubectl get secret pingora-tls --namespace pingora-system \\\n  --output jsonpath='{.data.tls\\.crt}' | base64 -d | openssl x509 -text -noout\n</code></pre>"},{"location":"configuration/gatewayclassconfig/#next-steps","title":"Next Steps","text":"<ul> <li>Learn about Gateway API resources</li> <li>Set up Monitoring for production</li> </ul>"},{"location":"configuration/helm-values/","title":"Helm Values","text":"<p>Complete reference for Helm chart configuration values.</p>"},{"location":"configuration/helm-values/#controller-configuration","title":"Controller Configuration","text":""},{"location":"configuration/helm-values/#controller","title":"<code>controller</code>","text":"<p>Controller behavior settings.</p> <pre><code>controller:\n  # GatewayClass name to watch\n  gatewayClassName: \"pingora\"\n\n  # Controller identifier (must be unique in cluster)\n  controllerName: \"pingora.k8s.lex.la/gateway-controller\"\n\n  # Kubernetes cluster domain (auto-detected if empty)\n  clusterDomain: \"\"\n\n  # Log level: debug, info, warn, error\n  logLevel: \"info\"\n\n  # Log format: json, text\n  logFormat: \"json\"\n</code></pre>"},{"location":"configuration/helm-values/#leaderelection","title":"<code>leaderElection</code>","text":"<p>High availability settings for multi-replica deployments.</p> <pre><code>leaderElection:\n  # Enable leader election\n  enabled: false\n\n  # Namespace for leader election lease\n  namespace: \"\"\n\n  # Name of the lease resource\n  leaseName: \"pingora-gateway-controller-leader\"\n</code></pre> <p>Required for HA</p> <p>Leader election must be enabled when running multiple controller replicas.</p>"},{"location":"configuration/helm-values/#pingoraconfig-settings","title":"PingoraConfig Settings","text":""},{"location":"configuration/helm-values/#pingoraconfig","title":"<code>pingoraConfig</code>","text":"<p>Configuration for the PingoraConfig CRD resource.</p> <pre><code>pingoraConfig:\n  # Create PingoraConfig resource\n  create: true\n\n  # Name of the PingoraConfig (defaults to release name)\n  name: \"\"\n\n  # gRPC endpoint address of Pingora proxy\n  # Auto-configured when proxy.enabled=true and address is empty\n  address: \"\"\n\n  # TLS settings for gRPC connection\n  tls:\n    enabled: false\n    secretRef:\n      name: \"\"\n      namespace: \"\"\n    insecureSkipVerify: false\n    serverName: \"\"\n\n  # Connection parameters\n  connection:\n    connectTimeoutSeconds: 5\n    requestTimeoutSeconds: 30\n    keepaliveTimeSeconds: 30\n    maxRetries: 3\n    retryBackoffMs: 1000\n</code></pre>"},{"location":"configuration/helm-values/#proxy-configuration","title":"Proxy Configuration","text":""},{"location":"configuration/helm-values/#proxy","title":"<code>proxy</code>","text":"<p>Pingora proxy deployment settings.</p> <pre><code>proxy:\n  # Enable proxy deployment\n  enabled: true\n\n  # Number of proxy replicas\n  replicaCount: 2\n\n  # Container image\n  image:\n    repository: ghcr.io/lexfrei/pingora-proxy\n    pullPolicy: IfNotPresent\n    tag: \"\"  # Defaults to appVersion\n\n  # Log level: trace, debug, info, warn, error\n  logLevel: \"info\"\n\n  # Resource limits\n  resources:\n    limits:\n      cpu: 500m\n      memory: 512Mi\n    requests:\n      cpu: 100m\n      memory: 128Mi\n\n  # Service configuration\n  service:\n    type: ClusterIP\n    annotations: {}\n</code></pre>"},{"location":"configuration/helm-values/#image-configuration","title":"Image Configuration","text":""},{"location":"configuration/helm-values/#image","title":"<code>image</code>","text":"<p>Controller container image settings.</p> <pre><code>image:\n  repository: ghcr.io/lexfrei/pingora-gateway-controller\n  pullPolicy: IfNotPresent\n  tag: \"\"  # Defaults to appVersion\n\nimagePullSecrets: []\n</code></pre>"},{"location":"configuration/helm-values/#resource-management","title":"Resource Management","text":""},{"location":"configuration/helm-values/#resources","title":"<code>resources</code>","text":"<p>Controller resource requests and limits.</p> <pre><code>resources:\n  limits:\n    cpu: 200m\n    memory: 256Mi\n  requests:\n    cpu: 100m\n    memory: 128Mi\n</code></pre>"},{"location":"configuration/helm-values/#replicacount","title":"<code>replicaCount</code>","text":"<p>Number of controller replicas. Enable <code>leaderElection</code> for multiple replicas.</p> <pre><code>replicaCount: 1\n</code></pre>"},{"location":"configuration/helm-values/#security-settings","title":"Security Settings","text":""},{"location":"configuration/helm-values/#podsecuritycontext","title":"<code>podSecurityContext</code>","text":"<p>Pod-level security settings.</p> <pre><code>podSecurityContext:\n  runAsNonRoot: true\n  runAsUser: 65534\n  seccompProfile:\n    type: RuntimeDefault\n</code></pre>"},{"location":"configuration/helm-values/#securitycontext","title":"<code>securityContext</code>","text":"<p>Container-level security settings.</p> <pre><code>securityContext:\n  allowPrivilegeEscalation: false\n  capabilities:\n    drop:\n      - ALL\n  readOnlyRootFilesystem: true\n</code></pre>"},{"location":"configuration/helm-values/#service-and-networking","title":"Service and Networking","text":""},{"location":"configuration/helm-values/#service","title":"<code>service</code>","text":"<p>Controller service configuration.</p> <pre><code>service:\n  type: ClusterIP\n  metricsPort: 8080\n  healthPort: 8081\n  annotations: {}\n</code></pre>"},{"location":"configuration/helm-values/#networkpolicy","title":"<code>networkPolicy</code>","text":"<p>Network policy for controller pods.</p> <pre><code>networkPolicy:\n  enabled: false\n  ingress:\n    from: []\n  pingoraProxy:\n    port: 50051\n    namespaceSelector: {}\n    podSelector: {}\n</code></pre>"},{"location":"configuration/helm-values/#observability","title":"Observability","text":""},{"location":"configuration/helm-values/#servicemonitor","title":"<code>serviceMonitor</code>","text":"<p>Prometheus ServiceMonitor configuration.</p> <pre><code>serviceMonitor:\n  enabled: false\n  interval: \"\"  # Uses Prometheus default\n  labels: {}    # For Prometheus selector\n</code></pre>"},{"location":"configuration/helm-values/#health-probes","title":"Health Probes","text":""},{"location":"configuration/helm-values/#healthprobes","title":"<code>healthProbes</code>","text":"<p>Kubernetes health probe settings.</p> <pre><code>healthProbes:\n  startupProbe:\n    enabled: true\n    initialDelaySeconds: 0\n    periodSeconds: 5\n    timeoutSeconds: 3\n    failureThreshold: 12\n\n  livenessProbe:\n    enabled: true\n    initialDelaySeconds: 15\n    periodSeconds: 20\n    timeoutSeconds: 5\n    failureThreshold: 3\n\n  readinessProbe:\n    enabled: true\n    initialDelaySeconds: 5\n    periodSeconds: 10\n    timeoutSeconds: 3\n    failureThreshold: 3\n</code></pre>"},{"location":"configuration/helm-values/#high-availability","title":"High Availability","text":""},{"location":"configuration/helm-values/#poddisruptionbudget","title":"<code>podDisruptionBudget</code>","text":"<p>PDB settings for availability during disruptions.</p> <pre><code>podDisruptionBudget:\n  enabled: false\n  minAvailable: 1\n  maxUnavailable: null\n  unhealthyPodEvictionPolicy: \"IfHealthyBudget\"\n</code></pre>"},{"location":"configuration/helm-values/#scheduling","title":"Scheduling","text":""},{"location":"configuration/helm-values/#node-selection-and-affinity","title":"Node Selection and Affinity","text":"<pre><code>nodeSelector: {}\ntolerations: []\naffinity: {}\ntopologySpreadConstraints: []\npriorityClassName: \"\"\n</code></pre>"},{"location":"configuration/helm-values/#gatewayclass","title":"GatewayClass","text":""},{"location":"configuration/helm-values/#gatewayclass_1","title":"<code>gatewayClass</code>","text":"<p>GatewayClass resource creation.</p> <pre><code>gatewayClass:\n  # Create GatewayClass resource\n  create: true\n</code></pre>"},{"location":"configuration/helm-values/#example-production-configuration","title":"Example: Production Configuration","text":"<pre><code># Production-ready values\nreplicaCount: 2\n\nleaderElection:\n  enabled: true\n\ncontroller:\n  logLevel: \"info\"\n  logFormat: \"json\"\n\nproxy:\n  enabled: true\n  replicaCount: 3\n  resources:\n    limits:\n      cpu: 2\n      memory: 2Gi\n    requests:\n      cpu: 500m\n      memory: 512Mi\n\nresources:\n  limits:\n    cpu: 500m\n    memory: 512Mi\n  requests:\n    cpu: 200m\n    memory: 256Mi\n\npodDisruptionBudget:\n  enabled: true\n  minAvailable: 1\n\nserviceMonitor:\n  enabled: true\n  labels:\n    release: prometheus\n\naffinity:\n  podAntiAffinity:\n    preferredDuringSchedulingIgnoredDuringExecution:\n      - weight: 100\n        podAffinityTerm:\n          labelSelector:\n            matchLabels:\n              app.kubernetes.io/name: pingora-gateway-controller\n          topologyKey: kubernetes.io/hostname\n</code></pre>"},{"location":"configuration/helm-values/#next-steps","title":"Next Steps","text":"<ul> <li>Configure PingoraConfig for proxy connection</li> <li>Learn about Gateway API resources</li> </ul>"},{"location":"development/","title":"Development","text":"<p>This section covers development setup, architecture, and contribution guidelines.</p>"},{"location":"development/#sections","title":"Sections","text":"<ul> <li> <p> Setup</p> <p>Set up your local development environment with all required tools.</p> <p> Setup</p> </li> <li> <p> Architecture</p> <p>Deep dive into the controller architecture, components, and data flow.</p> <p> Architecture</p> </li> <li> <p> Contributing</p> <p>Guidelines for contributing code, documentation, and reporting issues.</p> <p> Contributing</p> </li> <li> <p> Testing</p> <p>Testing patterns, running tests, and writing new test cases.</p> <p> Testing</p> </li> </ul>"},{"location":"development/#quick-start","title":"Quick Start","text":"<pre><code># Clone repository\ngit clone https://github.com/lexfrei/pingora-gateway-controller.git\ncd pingora-gateway-controller\n\n# Install dependencies\ngo mod download\n\n# Run tests\ngo test -race ./...\n\n# Build binary\ngo build -o bin/controller ./cmd/controller\n\n# Run linter\ngolangci-lint run\n</code></pre>"},{"location":"development/#project-structure","title":"Project Structure","text":"<pre><code>\u251c\u2500\u2500 api/\n\u2502   \u251c\u2500\u2500 proto/routing/v1/    # Protobuf schema for gRPC API\n\u2502   \u2514\u2500\u2500 v1alpha1/            # PingoraConfig CRD types\n\u251c\u2500\u2500 cmd/controller/          # Entrypoint and CLI\n\u251c\u2500\u2500 internal/\n\u2502   \u251c\u2500\u2500 config/              # PingoraConfig resolver\n\u2502   \u251c\u2500\u2500 controller/          # Kubernetes controllers\n\u2502   \u251c\u2500\u2500 dns/                 # Cluster domain detection\n\u2502   \u251c\u2500\u2500 ingress/             # Route \u2192 Pingora conversion\n\u2502   \u2514\u2500\u2500 metrics/             # Prometheus metrics\n\u251c\u2500\u2500 pkg/api/routing/v1/      # Generated gRPC client\n\u251c\u2500\u2500 proxy/                   # Git submodule: Pingora proxy\n\u251c\u2500\u2500 charts/                  # Helm chart\n\u251c\u2500\u2500 deploy/                  # Raw Kubernetes manifests\n\u2514\u2500\u2500 docs/                    # Documentation\n</code></pre>"},{"location":"development/#next-steps","title":"Next Steps","text":"<ul> <li>Set up Development Environment</li> <li>Understand the Architecture</li> <li>Read Contributing Guidelines</li> </ul>"},{"location":"development/architecture/","title":"Architecture","text":"<p>Deep dive into Pingora Gateway Controller architecture and design.</p>"},{"location":"development/architecture/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>graph TB\n    subgraph Kubernetes Cluster\n        subgraph Control Plane\n            API[Kubernetes API Server]\n        end\n\n        subgraph pingora-system\n            CTL[Controller&lt;br/&gt;Go]\n            PX[Pingora Proxy&lt;br/&gt;Rust]\n        end\n\n        subgraph Application Namespaces\n            GW[Gateway]\n            HR[HTTPRoute]\n            GR[GRPCRoute]\n            SVC[Backend Services]\n        end\n    end\n\n    CLIENT[Client Traffic] --&gt;|HTTP/gRPC| PX\n    API --&gt;|watch| CTL\n    CTL --&gt;|gRPC sync| PX\n    PX --&gt;|proxy| SVC\n    HR --&gt;|parentRef| GW\n    GR --&gt;|parentRef| GW</code></pre>"},{"location":"development/architecture/#components","title":"Components","text":""},{"location":"development/architecture/#controller-go","title":"Controller (Go)","text":"<p>The controller is a Kubernetes operator built with controller-runtime:</p> <pre><code>graph LR\n    subgraph Controller\n        GWC[GatewayReconciler]\n        HRC[HTTPRouteReconciler]\n        GRC[GRPCRouteReconciler]\n        SYNC[PingoraSyncer]\n        BUILD[PingoraBuilder]\n    end\n\n    API[K8s API] --&gt; GWC\n    API --&gt; HRC\n    API --&gt; GRC\n    HRC --&gt; BUILD\n    GRC --&gt; BUILD\n    BUILD --&gt; SYNC\n    SYNC --&gt;|gRPC| PROXY[Pingora Proxy]</code></pre>"},{"location":"development/architecture/#pingora-proxy-rust","title":"Pingora Proxy (Rust)","text":"<p>The proxy is built on Cloudflare's Pingora framework:</p> <ul> <li>High-performance HTTP/gRPC reverse proxy</li> <li>Dynamic configuration via gRPC API</li> <li>Zero-downtime route updates</li> </ul>"},{"location":"development/architecture/#controller-components","title":"Controller Components","text":""},{"location":"development/architecture/#gatewayreconciler","title":"GatewayReconciler","text":"<p>Watches Gateway resources and manages their lifecycle:</p> <ul> <li>Validates GatewayClass reference</li> <li>Resolves PingoraConfig from parametersRef</li> <li>Updates Gateway status conditions</li> </ul>"},{"location":"development/architecture/#httproutereconciler","title":"HTTPRouteReconciler","text":"<p>Watches HTTPRoute resources:</p> <ul> <li>Validates parent Gateway references</li> <li>Resolves backend Service references</li> <li>Triggers route synchronization</li> <li>Updates HTTPRoute status</li> </ul>"},{"location":"development/architecture/#grpcroutereconciler","title":"GRPCRouteReconciler","text":"<p>Similar to HTTPRouteReconciler for GRPCRoute:</p> <ul> <li>Validates parent Gateway references</li> <li>Resolves backend Service references</li> <li>Triggers route synchronization</li> <li>Updates GRPCRoute status</li> </ul>"},{"location":"development/architecture/#pingorasyncer","title":"PingoraSyncer","text":"<p>Manages communication with Pingora proxy:</p> <ul> <li>Establishes gRPC connection</li> <li>Converts routes to protobuf format</li> <li>Sends configuration updates</li> <li>Handles connection retry logic</li> </ul>"},{"location":"development/architecture/#pingorabuilder","title":"PingoraBuilder","text":"<p>Converts Gateway API resources to Pingora format:</p> <ul> <li>Builds route match conditions</li> <li>Resolves backend addresses</li> <li>Applies timeout configuration</li> </ul>"},{"location":"development/architecture/#data-flow","title":"Data Flow","text":""},{"location":"development/architecture/#route-configuration-flow","title":"Route Configuration Flow","text":"<pre><code>sequenceDiagram\n    participant User\n    participant K8s as Kubernetes API\n    participant Ctrl as Controller\n    participant Builder as PingoraBuilder\n    participant Syncer as PingoraSyncer\n    participant Proxy as Pingora Proxy\n\n    User-&gt;&gt;K8s: Create HTTPRoute\n    K8s-&gt;&gt;Ctrl: Watch event\n    Ctrl-&gt;&gt;K8s: Get referenced Gateway\n    Ctrl-&gt;&gt;K8s: Get backend Services\n    Ctrl-&gt;&gt;Builder: Build Pingora route\n    Builder--&gt;&gt;Ctrl: Route config\n    Ctrl-&gt;&gt;Syncer: Sync routes\n    Syncer-&gt;&gt;Proxy: gRPC SyncRoutes\n    Proxy--&gt;&gt;Syncer: Success\n    Syncer--&gt;&gt;Ctrl: Sync complete\n    Ctrl-&gt;&gt;K8s: Update HTTPRoute status</code></pre>"},{"location":"development/architecture/#request-flow","title":"Request Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant Proxy as Pingora Proxy\n    participant Backend as Backend Service\n\n    Client-&gt;&gt;Proxy: HTTP Request\n    Note over Proxy: Match route by&lt;br/&gt;host, path, headers\n    Proxy-&gt;&gt;Backend: Forward request\n    Backend--&gt;&gt;Proxy: Response\n    Proxy--&gt;&gt;Client: Response</code></pre>"},{"location":"development/architecture/#resource-relationships","title":"Resource Relationships","text":"<pre><code>erDiagram\n    GatewayClass ||--o| PingoraConfig : \"parametersRef\"\n    Gateway }|--|| GatewayClass : \"gatewayClassName\"\n    HTTPRoute }o--|| Gateway : \"parentRef\"\n    GRPCRoute }o--|| Gateway : \"parentRef\"\n    HTTPRoute }o--|{ Service : \"backendRef\"\n    GRPCRoute }o--|{ Service : \"backendRef\"\n    ReferenceGrant ||--o{ HTTPRoute : \"allows\"\n    ReferenceGrant ||--o{ GRPCRoute : \"allows\"</code></pre>"},{"location":"development/architecture/#key-design-decisions","title":"Key Design Decisions","text":""},{"location":"development/architecture/#why-grpc-for-controller-proxy-communication","title":"Why gRPC for Controller-Proxy Communication?","text":"<ul> <li>Efficient binary protocol</li> <li>Strong typing with protobuf</li> <li>Bi-directional streaming capability</li> <li>Built-in health checking</li> </ul>"},{"location":"development/architecture/#why-separate-controller-and-proxy","title":"Why Separate Controller and Proxy?","text":"<ul> <li>Independent scaling</li> <li>Language-specific optimization (Go for K8s, Rust for performance)</li> <li>Independent deployment lifecycle</li> <li>Clear separation of concerns</li> </ul>"},{"location":"development/architecture/#why-controller-runtime","title":"Why controller-runtime?","text":"<ul> <li>Battle-tested Kubernetes controller framework</li> <li>Built-in leader election</li> <li>Efficient watch caching</li> <li>Standardized patterns</li> </ul>"},{"location":"development/architecture/#package-structure","title":"Package Structure","text":"<pre><code>internal/\n\u251c\u2500\u2500 config/\n\u2502   \u2514\u2500\u2500 pingora_resolver.go    # PingoraConfig resolution\n\u251c\u2500\u2500 controller/\n\u2502   \u251c\u2500\u2500 gateway_controller.go  # Gateway reconciler\n\u2502   \u251c\u2500\u2500 httproute_controller.go # HTTPRoute reconciler\n\u2502   \u251c\u2500\u2500 grpcroute_controller.go # GRPCRoute reconciler\n\u2502   \u2514\u2500\u2500 pingora_syncer.go      # gRPC sync logic\n\u251c\u2500\u2500 dns/\n\u2502   \u2514\u2500\u2500 detect.go              # Cluster domain detection\n\u251c\u2500\u2500 ingress/\n\u2502   \u2514\u2500\u2500 pingora_builder.go     # Route conversion\n\u2514\u2500\u2500 metrics/\n    \u2514\u2500\u2500 metrics.go             # Prometheus metrics\n</code></pre>"},{"location":"development/architecture/#configuration-flow","title":"Configuration Flow","text":"<pre><code>graph TD\n    GC[GatewayClass] --&gt;|parametersRef| PC[PingoraConfig]\n    PC --&gt;|address| GRPC[gRPC Connection]\n    PC --&gt;|tls| TLS[TLS Config]\n    PC --&gt;|connection| CONN[Connection Params]\n    GRPC --&gt; PROXY[Pingora Proxy]</code></pre>"},{"location":"development/architecture/#error-handling","title":"Error Handling","text":""},{"location":"development/architecture/#retry-strategy","title":"Retry Strategy","text":"<ul> <li>gRPC connection: Exponential backoff with jitter</li> <li>Failed syncs: Immediate retry with rate limiting</li> <li>Transient errors: Automatic retry via controller-runtime</li> </ul>"},{"location":"development/architecture/#status-reporting","title":"Status Reporting","text":"<ul> <li>Gateway conditions: Accepted, Programmed</li> <li>Route conditions: Accepted, ResolvedRefs</li> <li>PingoraConfig status: Connected, LastSyncTime</li> </ul>"},{"location":"development/architecture/#next-steps","title":"Next Steps","text":"<ul> <li>Read Contributing Guidelines</li> <li>Learn about Testing</li> </ul>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Guidelines for contributing to Pingora Gateway Controller.</p>"},{"location":"development/contributing/#getting-started","title":"Getting Started","text":"<ol> <li>Fork the repository</li> <li>Clone your fork</li> <li>Set up development environment</li> <li>Create a feature branch</li> <li>Make changes and test</li> <li>Submit a pull request</li> </ol>"},{"location":"development/contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"development/contributing/#branch-naming","title":"Branch Naming","text":"<p>Use descriptive branch names:</p> <ul> <li><code>feat/add-tls-support</code></li> <li><code>fix/route-sync-error</code></li> <li><code>docs/update-architecture</code></li> <li><code>refactor/simplify-builder</code></li> </ul>"},{"location":"development/contributing/#commit-messages","title":"Commit Messages","text":"<p>Use semantic commit messages:</p> <pre><code>type(scope): brief description\n\nOptional longer explanation of what was changed and why.\n\nCo-Authored-By: Claude &lt;noreply@anthropic.com&gt;\n</code></pre> <p>Types:</p> Type Description <code>feat</code> New features <code>fix</code> Bug fixes <code>docs</code> Documentation changes <code>style</code> Code style changes <code>refactor</code> Code refactoring <code>test</code> Test changes <code>chore</code> Maintenance tasks <code>ci</code> CI/CD changes <code>perf</code> Performance improvements <p>Examples:</p> <pre><code>feat(controller): add GRPCRoute support\n\nImplement GRPCRouteReconciler to watch and sync GRPCRoute resources\nto Pingora proxy. Includes service/method matching and header-based\nrouting.\n\nCo-Authored-By: Claude &lt;noreply@anthropic.com&gt;\n</code></pre> <pre><code>fix(sync): handle connection timeout gracefully\n\nAdd retry logic with exponential backoff when gRPC connection\nto Pingora proxy times out.\n\nCo-Authored-By: Claude &lt;noreply@anthropic.com&gt;\n</code></pre>"},{"location":"development/contributing/#code-standards","title":"Code Standards","text":""},{"location":"development/contributing/#go-code","title":"Go Code","text":"<ul> <li>Follow Effective Go</li> <li>Pass <code>golangci-lint run</code> without errors</li> <li>Write tests for new functionality</li> <li>Use meaningful variable and function names</li> </ul>"},{"location":"development/contributing/#error-handling","title":"Error Handling","text":"<pre><code>// Good\nif err != nil {\n    return errors.Wrap(err, \"failed to sync routes\")\n}\n\n// Bad\nif err != nil {\n    return err\n}\n</code></pre>"},{"location":"development/contributing/#logging","title":"Logging","text":"<pre><code>// Good\nlogger.Info(\"syncing routes\",\n    \"gateway\", gateway.Name,\n    \"routeCount\", len(routes),\n)\n\n// Bad\nlogger.Info(fmt.Sprintf(\"syncing %d routes for gateway %s\", len(routes), gateway.Name))\n</code></pre>"},{"location":"development/contributing/#testing-requirements","title":"Testing Requirements","text":""},{"location":"development/contributing/#unit-tests","title":"Unit Tests","text":"<ul> <li>All new code must have tests</li> <li>Maintain or improve coverage</li> <li>Use table-driven tests</li> </ul>"},{"location":"development/contributing/#test-patterns","title":"Test Patterns","text":"<pre><code>func TestFeature(t *testing.T) {\n    t.Parallel()\n\n    tests := []struct {\n        name     string\n        input    InputType\n        expected OutputType\n    }{\n        {name: \"case 1\", input: ..., expected: ...},\n        {name: \"case 2\", input: ..., expected: ...},\n    }\n\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            t.Parallel()\n            // test logic\n        })\n    }\n}\n</code></pre>"},{"location":"development/contributing/#running-tests","title":"Running Tests","text":"<pre><code># All tests\ngo test -race ./...\n\n# With coverage\ngo test -race -coverprofile=coverage.out ./...\n</code></pre>"},{"location":"development/contributing/#pull-request-process","title":"Pull Request Process","text":""},{"location":"development/contributing/#before-submitting","title":"Before Submitting","text":"<ol> <li>Run tests: <code>go test -race ./...</code></li> <li>Run linter: <code>golangci-lint run</code></li> <li>Update documentation if needed</li> <li>Add tests for new functionality</li> </ol>"},{"location":"development/contributing/#pr-title","title":"PR Title","text":"<p>Use semantic format:</p> <pre><code>feat(scope): add feature description\nfix(scope): fix bug description\ndocs(scope): update documentation\n</code></pre>"},{"location":"development/contributing/#pr-description","title":"PR Description","text":"<p>Use the template from <code>.github/pull_request_template.md</code>:</p> <ul> <li>Summary of changes</li> <li>Related issues (if any)</li> <li>Testing performed</li> <li>Checklist completion</li> </ul>"},{"location":"development/contributing/#review-process","title":"Review Process","text":"<ol> <li>Automated checks must pass</li> <li>Code review by maintainer</li> <li>Address review feedback</li> <li>Maintainer approval</li> <li>Squash and merge</li> </ol>"},{"location":"development/contributing/#documentation","title":"Documentation","text":""},{"location":"development/contributing/#updating-docs","title":"Updating Docs","text":"<ul> <li>Update docs alongside code changes</li> <li>Run <code>mkdocs build --strict</code> to verify</li> <li>Run <code>markdownlint-cli2 '**/*.md'</code> to lint</li> </ul>"},{"location":"development/contributing/#documentation-style","title":"Documentation Style","text":"<ul> <li>Use clear, concise language</li> <li>Include code examples</li> <li>Use admonitions for notes/warnings</li> <li>Keep examples up to date</li> </ul>"},{"location":"development/contributing/#helm-chart-changes","title":"Helm Chart Changes","text":""},{"location":"development/contributing/#testing-changes","title":"Testing Changes","text":"<pre><code># Run unit tests\nhelm unittest charts/pingora-gateway-controller\n\n# Lint chart\nhelm lint charts/pingora-gateway-controller\n\n# Update README\nhelm-docs charts/pingora-gateway-controller\n</code></pre>"},{"location":"development/contributing/#values-changes","title":"Values Changes","text":"<ul> <li>Update <code>values.yaml</code> with comments</li> <li>Add tests for new values</li> <li>Update documentation</li> </ul>"},{"location":"development/contributing/#issue-reporting","title":"Issue Reporting","text":""},{"location":"development/contributing/#bug-reports","title":"Bug Reports","text":"<p>Include:</p> <ul> <li>Controller version</li> <li>Kubernetes version</li> <li>Gateway API version</li> <li>Steps to reproduce</li> <li>Expected vs actual behavior</li> <li>Logs and error messages</li> </ul>"},{"location":"development/contributing/#feature-requests","title":"Feature Requests","text":"<p>Include:</p> <ul> <li>Use case description</li> <li>Proposed solution</li> <li>Alternative approaches considered</li> </ul>"},{"location":"development/contributing/#code-of-conduct","title":"Code of Conduct","text":"<ul> <li>Be respectful and inclusive</li> <li>Focus on constructive feedback</li> <li>Help others learn and grow</li> <li>Follow project guidelines</li> </ul>"},{"location":"development/contributing/#getting-help","title":"Getting Help","text":"<ul> <li>Check existing issues</li> <li>Ask questions in issue discussions</li> <li>Read the documentation</li> </ul>"},{"location":"development/contributing/#next-steps","title":"Next Steps","text":"<ul> <li>Learn about Testing</li> <li>Understand the Architecture</li> </ul>"},{"location":"development/setup/","title":"Development Setup","text":"<p>Set up your local development environment for Pingora Gateway Controller.</p>"},{"location":"development/setup/#prerequisites","title":"Prerequisites","text":""},{"location":"development/setup/#required-tools","title":"Required Tools","text":"Tool Version Purpose Go 1.23+ Build and test kubectl Latest Kubernetes CLI Helm 3.x Chart testing golangci-lint Latest Code linting buf Latest Protobuf generation"},{"location":"development/setup/#optional-tools","title":"Optional Tools","text":"Tool Purpose kind Local Kubernetes cluster podman/docker Container building helm-unittest Helm chart testing markdownlint-cli2 Documentation linting"},{"location":"development/setup/#installation","title":"Installation","text":""},{"location":"development/setup/#macos-homebrew","title":"macOS (Homebrew)","text":"<pre><code># Go\nbrew install go\n\n# Kubernetes tools\nbrew install kubectl helm\n\n# Development tools\nbrew install golangci-lint buf\n\n# Optional\nbrew install kind podman helm-unittest markdownlint-cli2\n</code></pre>"},{"location":"development/setup/#linux","title":"Linux","text":"<pre><code># Go (from go.dev)\nwget https://go.dev/dl/go1.23.linux-amd64.tar.gz\nsudo tar -C /usr/local -xzf go1.23.linux-amd64.tar.gz\nexport PATH=$PATH:/usr/local/go/bin\n\n# golangci-lint\ncurl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin\n\n# buf\nGO111MODULE=on go install github.com/bufbuild/buf/cmd/buf@latest\n</code></pre>"},{"location":"development/setup/#clone-repository","title":"Clone Repository","text":"<pre><code>git clone https://github.com/lexfrei/pingora-gateway-controller.git\ncd pingora-gateway-controller\n\n# Initialize submodules (for proxy)\ngit submodule update --init --recursive\n</code></pre>"},{"location":"development/setup/#build","title":"Build","text":""},{"location":"development/setup/#build-controller-binary","title":"Build Controller Binary","text":"<pre><code>go build -o bin/controller ./cmd/controller\n</code></pre>"},{"location":"development/setup/#build-with-version-info","title":"Build with Version Info","text":"<pre><code>go build -ldflags \"-X main.Version=v0.0.1 -X main.Gitsha=$(git rev-parse HEAD)\" \\\n  -o bin/controller ./cmd/controller\n</code></pre>"},{"location":"development/setup/#build-container-image","title":"Build Container Image","text":"<pre><code>podman build --tag pingora-gateway-controller:dev --file Containerfile .\n</code></pre>"},{"location":"development/setup/#run-locally","title":"Run Locally","text":""},{"location":"development/setup/#against-remote-cluster","title":"Against Remote Cluster","text":"<pre><code># Ensure kubectl is configured\nkubectl config current-context\n\n# Run controller\n./bin/controller \\\n  --gateway-class-name=pingora \\\n  --log-level=debug \\\n  --log-format=text\n</code></pre>"},{"location":"development/setup/#with-kind-cluster","title":"With kind Cluster","text":"<pre><code># Create cluster\nkind create cluster --name pingora-dev\n\n# Install Gateway API CRDs\nkubectl apply --filename https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.4.1/standard-install.yaml\n\n# Load local image\nkind load docker-image pingora-gateway-controller:dev --name pingora-dev\n\n# Install with Helm\nhelm install pingora-gateway-controller charts/pingora-gateway-controller \\\n  --namespace pingora-system \\\n  --create-namespace \\\n  --set image.tag=dev \\\n  --set image.pullPolicy=Never\n</code></pre>"},{"location":"development/setup/#ide-setup","title":"IDE Setup","text":""},{"location":"development/setup/#vs-code","title":"VS Code","text":"<p>Recommended extensions:</p> <ul> <li>Go (golang.go)</li> <li>YAML (redhat.vscode-yaml)</li> <li>Markdown All in One (yzhang.markdown-all-in-one)</li> <li>Kubernetes (ms-kubernetes-tools.vscode-kubernetes-tools)</li> </ul> <p>Settings (<code>.vscode/settings.json</code>):</p> <pre><code>{\n  \"go.lintTool\": \"golangci-lint\",\n  \"go.lintFlags\": [\"--fast\"],\n  \"editor.formatOnSave\": true,\n  \"[go]\": {\n    \"editor.defaultFormatter\": \"golang.go\"\n  }\n}\n</code></pre>"},{"location":"development/setup/#golandintellij","title":"GoLand/IntelliJ","text":"<ul> <li>Enable golangci-lint integration</li> <li>Configure Go modules</li> <li>Set up Kubernetes plugin</li> </ul>"},{"location":"development/setup/#development-workflow","title":"Development Workflow","text":""},{"location":"development/setup/#make-changes","title":"Make Changes","text":"<ol> <li>Create feature branch</li> <li>Make changes</li> <li>Run tests and linter</li> <li>Commit with semantic message</li> </ol>"},{"location":"development/setup/#test-cycle","title":"Test Cycle","text":"<pre><code># Run all tests\ngo test -race ./...\n\n# Run specific package\ngo test -v -race ./internal/controller/...\n\n# Run with coverage\ngo test -race -coverprofile=coverage.out ./...\ngo tool cover -html=coverage.out\n</code></pre>"},{"location":"development/setup/#lint-cycle","title":"Lint Cycle","text":"<pre><code># Run linter\ngolangci-lint run\n\n# Auto-fix where possible\ngolangci-lint run --fix\n</code></pre>"},{"location":"development/setup/#protobuf-generation","title":"Protobuf Generation","text":"<p>If modifying protobuf schema:</p> <pre><code>buf generate\n</code></pre>"},{"location":"development/setup/#helm-chart-development","title":"Helm Chart Development","text":""},{"location":"development/setup/#run-tests","title":"Run Tests","text":"<pre><code>helm unittest charts/pingora-gateway-controller\n</code></pre>"},{"location":"development/setup/#generate-readme","title":"Generate README","text":"<pre><code>helm-docs charts/pingora-gateway-controller\n</code></pre>"},{"location":"development/setup/#lint-chart","title":"Lint Chart","text":"<pre><code>helm lint charts/pingora-gateway-controller\n</code></pre>"},{"location":"development/setup/#documentation-development","title":"Documentation Development","text":""},{"location":"development/setup/#local-preview","title":"Local Preview","text":"<pre><code># Install dependencies\npip install --requirement requirements-docs.txt\n\n# Serve locally\nmkdocs serve\n</code></pre>"},{"location":"development/setup/#build-documentation","title":"Build Documentation","text":"<pre><code>mkdocs build --strict\n</code></pre>"},{"location":"development/setup/#lint-markdown","title":"Lint Markdown","text":"<pre><code>markdownlint-cli2 '**/*.md'\n</code></pre>"},{"location":"development/setup/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/setup/#go-module-issues","title":"Go Module Issues","text":"<pre><code>go mod tidy\ngo mod download\n</code></pre>"},{"location":"development/setup/#submodule-issues","title":"Submodule Issues","text":"<pre><code>git submodule update --init --recursive\n</code></pre>"},{"location":"development/setup/#golangci-lint-cache","title":"golangci-lint Cache","text":"<pre><code>golangci-lint cache clean\n</code></pre>"},{"location":"development/setup/#next-steps","title":"Next Steps","text":"<ul> <li>Understand the Architecture</li> <li>Read Contributing Guidelines</li> <li>Learn about Testing</li> </ul>"},{"location":"development/testing/","title":"Testing","text":"<p>Testing patterns and practices for Pingora Gateway Controller.</p>"},{"location":"development/testing/#testing-philosophy","title":"Testing Philosophy","text":"<ul> <li>TDD (Test-Driven Development): Write tests first, then implementation</li> <li>Table-driven tests: Use structured test cases</li> <li>Parallel execution: Tests should be parallelizable</li> <li>Meaningful assertions: Test behavior, not implementation</li> </ul>"},{"location":"development/testing/#running-tests","title":"Running Tests","text":""},{"location":"development/testing/#all-tests","title":"All Tests","text":"<pre><code>go test -race ./...\n</code></pre>"},{"location":"development/testing/#specific-package","title":"Specific Package","text":"<pre><code>go test -v -race ./internal/controller/...\n</code></pre>"},{"location":"development/testing/#single-test","title":"Single Test","text":"<pre><code>go test -v -race ./internal/controller/... -run TestHTTPRouteReconciler\n</code></pre>"},{"location":"development/testing/#with-coverage","title":"With Coverage","text":"<pre><code>go test -race -coverprofile=coverage.out ./...\ngo tool cover -html=coverage.out\n</code></pre>"},{"location":"development/testing/#short-tests-only","title":"Short Tests Only","text":"<pre><code>go test -short ./...\n</code></pre>"},{"location":"development/testing/#test-structure","title":"Test Structure","text":""},{"location":"development/testing/#package-layout","title":"Package Layout","text":"<pre><code>internal/\n\u251c\u2500\u2500 controller/\n\u2502   \u251c\u2500\u2500 gateway_controller.go\n\u2502   \u251c\u2500\u2500 gateway_controller_test.go\n\u2502   \u251c\u2500\u2500 httproute_controller.go\n\u2502   \u2514\u2500\u2500 httproute_controller_test.go\n\u251c\u2500\u2500 ingress/\n\u2502   \u251c\u2500\u2500 pingora_builder.go\n\u2502   \u2514\u2500\u2500 pingora_builder_test.go\n\u2514\u2500\u2500 dns/\n    \u251c\u2500\u2500 detect.go\n    \u2514\u2500\u2500 detect_test.go\n</code></pre>"},{"location":"development/testing/#test-file-naming","title":"Test File Naming","text":"<ul> <li>Test files: <code>*_test.go</code></li> <li>Same package as code under test</li> <li>Internal tests access private members</li> </ul>"},{"location":"development/testing/#test-patterns","title":"Test Patterns","text":""},{"location":"development/testing/#table-driven-tests","title":"Table-Driven Tests","text":"<pre><code>func TestBuildHTTPRoute(t *testing.T) {\n    t.Parallel()\n\n    tests := []struct {\n        name     string\n        route    *gatewayv1.HTTPRoute\n        expected *routingv1.HTTPRoute\n    }{\n        {\n            name: \"basic route\",\n            route: &amp;gatewayv1.HTTPRoute{\n                ObjectMeta: metav1.ObjectMeta{\n                    Name:      \"test-route\",\n                    Namespace: \"default\",\n                },\n                Spec: gatewayv1.HTTPRouteSpec{\n                    Hostnames: []gatewayv1.Hostname{\"example.com\"},\n                },\n            },\n            expected: &amp;routingv1.HTTPRoute{\n                Id:        \"default/test-route\",\n                Hostnames: []string{\"example.com\"},\n            },\n        },\n        // More test cases...\n    }\n\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            t.Parallel()\n\n            builder := NewPingoraBuilder(\"cluster.local\")\n            result := builder.BuildHTTPRoute(tt.route)\n\n            assert.Equal(t, tt.expected.Id, result.Id)\n            assert.Equal(t, tt.expected.Hostnames, result.Hostnames)\n        })\n    }\n}\n</code></pre>"},{"location":"development/testing/#fake-client-setup","title":"Fake Client Setup","text":"<pre><code>func setupFakeClient(t *testing.T, objs ...client.Object) client.Client {\n    t.Helper()\n\n    scheme := runtime.NewScheme()\n    require.NoError(t, clientgoscheme.AddToScheme(scheme))\n    require.NoError(t, gatewayv1.AddToScheme(scheme))\n    require.NoError(t, v1alpha1.AddToScheme(scheme))\n\n    return fake.NewClientBuilder().\n        WithScheme(scheme).\n        WithObjects(objs...).\n        Build()\n}\n</code></pre>"},{"location":"development/testing/#controller-tests","title":"Controller Tests","text":"<pre><code>func TestHTTPRouteReconciler_Reconcile(t *testing.T) {\n    t.Parallel()\n\n    gateway := &amp;gatewayv1.Gateway{\n        ObjectMeta: metav1.ObjectMeta{\n            Name:      \"test-gateway\",\n            Namespace: \"pingora-system\",\n        },\n        Spec: gatewayv1.GatewaySpec{\n            GatewayClassName: \"pingora\",\n        },\n    }\n\n    route := &amp;gatewayv1.HTTPRoute{\n        ObjectMeta: metav1.ObjectMeta{\n            Name:      \"test-route\",\n            Namespace: \"default\",\n        },\n        Spec: gatewayv1.HTTPRouteSpec{\n            ParentRefs: []gatewayv1.ParentReference{\n                {\n                    Name:      \"test-gateway\",\n                    Namespace: ptr.To(gatewayv1.Namespace(\"pingora-system\")),\n                },\n            },\n        },\n    }\n\n    client := setupFakeClient(t, gateway, route)\n    reconciler := &amp;HTTPRouteReconciler{\n        Client: client,\n        Scheme: client.Scheme(),\n    }\n\n    req := ctrl.Request{\n        NamespacedName: types.NamespacedName{\n            Name:      \"test-route\",\n            Namespace: \"default\",\n        },\n    }\n\n    result, err := reconciler.Reconcile(context.Background(), req)\n\n    require.NoError(t, err)\n    assert.False(t, result.Requeue)\n}\n</code></pre>"},{"location":"development/testing/#testing-libraries","title":"Testing Libraries","text":""},{"location":"development/testing/#testify","title":"testify","text":"<p>Used for assertions and requirements:</p> <pre><code>import (\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/require\"\n)\n\n// assert - continues on failure\nassert.Equal(t, expected, actual)\nassert.NoError(t, err)\nassert.Len(t, slice, 3)\n\n// require - stops on failure\nrequire.NoError(t, err)\nrequire.NotNil(t, result)\n</code></pre>"},{"location":"development/testing/#fake-client","title":"Fake Client","text":"<p>controller-runtime fake client for unit tests:</p> <pre><code>import \"sigs.k8s.io/controller-runtime/pkg/client/fake\"\n\nclient := fake.NewClientBuilder().\n    WithScheme(scheme).\n    WithObjects(objs...).\n    WithStatusSubresource(statusObjs...).\n    Build()\n</code></pre>"},{"location":"development/testing/#envtest","title":"envtest","text":"<p>Integration tests with real API server:</p> <pre><code>import \"sigs.k8s.io/controller-runtime/pkg/envtest\"\n\nfunc TestMain(m *testing.M) {\n    testEnv := &amp;envtest.Environment{\n        CRDDirectoryPaths: []string{\n            filepath.Join(\"..\", \"..\", \"config\", \"crd\", \"bases\"),\n        },\n    }\n\n    cfg, err := testEnv.Start()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    code := m.Run()\n\n    testEnv.Stop()\n    os.Exit(code)\n}\n</code></pre>"},{"location":"development/testing/#helm-chart-tests","title":"Helm Chart Tests","text":""},{"location":"development/testing/#helm-unittest","title":"helm-unittest","text":"<pre><code># tests/deployment_test.yaml\nsuite: test deployment\ntemplates:\n  - templates/deployment.yaml\ntests:\n  - it: should create deployment\n    asserts:\n      - isKind:\n          of: Deployment\n      - equal:\n          path: metadata.name\n          value: RELEASE-NAME-pingora-gateway-controller\n</code></pre>"},{"location":"development/testing/#running-helm-tests","title":"Running Helm Tests","text":"<pre><code>helm unittest charts/pingora-gateway-controller\n</code></pre>"},{"location":"development/testing/#mocking","title":"Mocking","text":""},{"location":"development/testing/#interface-based-mocking","title":"Interface-Based Mocking","text":"<pre><code>// Define interface\ntype Syncer interface {\n    SyncRoutes(ctx context.Context, routes []*routingv1.HTTPRoute) error\n}\n\n// Mock implementation\ntype MockSyncer struct {\n    SyncRoutesFunc func(ctx context.Context, routes []*routingv1.HTTPRoute) error\n}\n\nfunc (m *MockSyncer) SyncRoutes(ctx context.Context, routes []*routingv1.HTTPRoute) error {\n    return m.SyncRoutesFunc(ctx, routes)\n}\n\n// Use in tests\nsyncer := &amp;MockSyncer{\n    SyncRoutesFunc: func(ctx context.Context, routes []*routingv1.HTTPRoute) error {\n        assert.Len(t, routes, 1)\n        return nil\n    },\n}\n</code></pre>"},{"location":"development/testing/#test-coverage","title":"Test Coverage","text":""},{"location":"development/testing/#generating-coverage-report","title":"Generating Coverage Report","text":"<pre><code>go test -race -coverprofile=coverage.out ./...\ngo tool cover -html=coverage.out -o coverage.html\n</code></pre>"},{"location":"development/testing/#coverage-guidelines","title":"Coverage Guidelines","text":"<ul> <li>Aim for &gt;80% coverage on business logic</li> <li>Focus on critical paths</li> <li>Don't chase 100% coverage</li> <li>Test error conditions</li> </ul>"},{"location":"development/testing/#ci-testing","title":"CI Testing","text":"<p>Tests run automatically on:</p> <ul> <li>Pull request creation</li> <li>Push to feature branch</li> <li>Merge to master</li> </ul>"},{"location":"development/testing/#ci-checks","title":"CI Checks","text":"<ol> <li>Unit tests: <code>go test -race ./...</code></li> <li>Linting: <code>golangci-lint run</code></li> <li>Helm tests: <code>helm unittest charts/...</code></li> <li>Documentation: <code>mkdocs build --strict</code></li> </ol>"},{"location":"development/testing/#debugging-tests","title":"Debugging Tests","text":""},{"location":"development/testing/#verbose-output","title":"Verbose Output","text":"<pre><code>go test -v ./internal/controller/... -run TestHTTPRoute\n</code></pre>"},{"location":"development/testing/#with-debug-logging","title":"With Debug Logging","text":"<pre><code>func TestWithDebug(t *testing.T) {\n    logger := slog.New(slog.NewTextHandler(os.Stdout, &amp;slog.HandlerOptions{\n        Level: slog.LevelDebug,\n    }))\n    // Use logger in test\n}\n</code></pre>"},{"location":"development/testing/#debugging-specific-test","title":"Debugging Specific Test","text":"<pre><code># Run single test with verbose output\ngo test -v -race ./internal/controller/... -run TestHTTPRouteReconciler/case_name\n\n# With race detector and CPU profiling\ngo test -v -race -cpuprofile=cpu.prof ./internal/controller/... -run TestHTTPRouteReconciler\n</code></pre>"},{"location":"development/testing/#next-steps","title":"Next Steps","text":"<ul> <li>Read Contributing Guidelines</li> <li>Understand the Architecture</li> </ul>"},{"location":"gateway-api/","title":"Gateway API","text":"<p>This section covers the Gateway API resources supported by Pingora Gateway Controller.</p>"},{"location":"gateway-api/#overview","title":"Overview","text":"<p>The controller implements the Kubernetes Gateway API, providing a standardized way to configure HTTP and gRPC routing through Pingora proxy.</p>"},{"location":"gateway-api/#sections","title":"Sections","text":"<ul> <li> <p> Supported Resources</p> <p>Compatibility matrix and feature support levels for Gateway API resources.</p> <p> Supported Resources</p> </li> <li> <p> HTTPRoute</p> <p>HTTP routing configuration with path, header, and query parameter matching.</p> <p> HTTPRoute</p> </li> <li> <p> GRPCRoute</p> <p>gRPC routing configuration with service and method matching.</p> <p> GRPCRoute</p> </li> <li> <p> ReferenceGrant</p> <p>Cross-namespace reference permissions for services and secrets.</p> <p> ReferenceGrant</p> </li> <li> <p> Limitations</p> <p>Current limitations and unsupported features.</p> <p> Limitations</p> </li> </ul>"},{"location":"gateway-api/#quick-example","title":"Quick Example","text":"<pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: example\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - app.example.com\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api\n      backendRefs:\n        - name: api-service\n          port: 8080\n</code></pre>"},{"location":"gateway-api/#resource-hierarchy","title":"Resource Hierarchy","text":"<pre><code>graph TD\n    GC[GatewayClass] --&gt;|references| PC[PingoraConfig]\n    GW[Gateway] --&gt;|uses| GC\n    HR[HTTPRoute] --&gt;|parentRef| GW\n    GR[GRPCRoute] --&gt;|parentRef| GW\n    HR --&gt;|backendRef| SVC1[Service]\n    GR --&gt;|backendRef| SVC2[Service]\n    RG[ReferenceGrant] -.-&gt;|allows| HR\n    RG -.-&gt;|allows| GR</code></pre>"},{"location":"gateway-api/#next-steps","title":"Next Steps","text":"<ul> <li>Review Supported Resources for compatibility</li> <li>Configure HTTPRoute for HTTP traffic</li> <li>Set up GRPCRoute for gRPC services</li> </ul>"},{"location":"gateway-api/grpcroute/","title":"GRPCRoute","text":"<p>GRPCRoute defines gRPC routing rules for traffic entering through a Gateway.</p>"},{"location":"gateway-api/grpcroute/#basic-example","title":"Basic Example","text":"<pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: GRPCRoute\nmetadata:\n  name: grpc-route\n  namespace: default\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - grpc.example.com\n  rules:\n    - backendRefs:\n        - name: grpc-service\n          port: 50051\n</code></pre>"},{"location":"gateway-api/grpcroute/#method-matching","title":"Method Matching","text":""},{"location":"gateway-api/grpcroute/#service-and-method","title":"Service and Method","text":"<p>Route based on gRPC service and method:</p> <pre><code>rules:\n  - matches:\n      - method:\n          service: helloworld.Greeter\n          method: SayHello\n    backendRefs:\n      - name: greeter-service\n        port: 50051\n</code></pre>"},{"location":"gateway-api/grpcroute/#service-only","title":"Service Only","text":"<p>Route all methods of a service:</p> <pre><code>rules:\n  - matches:\n      - method:\n          service: helloworld.Greeter\n    backendRefs:\n      - name: greeter-service\n        port: 50051\n</code></pre>"},{"location":"gateway-api/grpcroute/#regex-matching","title":"Regex Matching","text":"<p>Use regex patterns for flexible matching:</p> <pre><code>rules:\n  - matches:\n      - method:\n          type: RegularExpression\n          service: \".*\\\\.v2\\\\..*\"\n    backendRefs:\n      - name: v2-service\n        port: 50051\n</code></pre>"},{"location":"gateway-api/grpcroute/#header-matching","title":"Header Matching","text":"<p>Route based on gRPC metadata (headers):</p> <pre><code>rules:\n  - matches:\n      - headers:\n          - name: x-tenant-id\n            value: acme\n    backendRefs:\n      - name: acme-backend\n        port: 50051\n  - matches:\n      - headers:\n          - name: x-tenant-id\n            value: globex\n    backendRefs:\n      - name: globex-backend\n        port: 50051\n</code></pre>"},{"location":"gateway-api/grpcroute/#combined-method-and-header","title":"Combined Method and Header","text":"<pre><code>rules:\n  - matches:\n      - method:\n          service: helloworld.Greeter\n        headers:\n          - name: x-environment\n            value: staging\n    backendRefs:\n      - name: staging-greeter\n        port: 50051\n</code></pre>"},{"location":"gateway-api/grpcroute/#weighted-backends","title":"Weighted Backends","text":"<p>Split gRPC traffic between services:</p> <pre><code>rules:\n  - matches:\n      - method:\n          service: payment.PaymentService\n    backendRefs:\n      - name: payment-v1\n        port: 50051\n        weight: 80\n      - name: payment-v2\n        port: 50051\n        weight: 20\n</code></pre>"},{"location":"gateway-api/grpcroute/#multiple-services","title":"Multiple Services","text":"<p>Route different services to different backends:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: GRPCRoute\nmetadata:\n  name: multi-service-route\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - api.example.com\n  rules:\n    # User service\n    - matches:\n        - method:\n            service: user.UserService\n      backendRefs:\n        - name: user-service\n          port: 50051\n\n    # Order service\n    - matches:\n        - method:\n            service: order.OrderService\n      backendRefs:\n        - name: order-service\n          port: 50051\n\n    # Default: reflection and health\n    - backendRefs:\n        - name: default-grpc\n          port: 50051\n</code></pre>"},{"location":"gateway-api/grpcroute/#cross-namespace-backend","title":"Cross-Namespace Backend","text":"<p>Reference a gRPC service in another namespace:</p> <pre><code>rules:\n  - matches:\n      - method:\n          service: shared.AuthService\n    backendRefs:\n      - name: auth-service\n        namespace: auth-system\n        port: 50051\n</code></pre> <p>ReferenceGrant Required</p> <p>Cross-namespace references require a ReferenceGrant in the target namespace.</p>"},{"location":"gateway-api/grpcroute/#health-checking","title":"Health Checking","text":"<p>Route gRPC health check requests:</p> <pre><code>rules:\n  # Health check service\n  - matches:\n      - method:\n          service: grpc.health.v1.Health\n    backendRefs:\n      - name: health-service\n        port: 50051\n\n  # Main application\n  - backendRefs:\n      - name: app-service\n        port: 50051\n</code></pre>"},{"location":"gateway-api/grpcroute/#reflection-service","title":"Reflection Service","text":"<p>Route gRPC reflection requests:</p> <pre><code>rules:\n  # Reflection (for grpcurl, etc.)\n  - matches:\n      - method:\n          service: grpc.reflection.v1alpha.ServerReflection\n    backendRefs:\n      - name: reflection-service\n        port: 50051\n</code></pre>"},{"location":"gateway-api/grpcroute/#complete-example","title":"Complete Example","text":"<pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: GRPCRoute\nmetadata:\n  name: comprehensive-grpc-route\n  namespace: default\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - grpc.example.com\n  rules:\n    # Health check with dedicated backend\n    - matches:\n        - method:\n            service: grpc.health.v1.Health\n      backendRefs:\n        - name: health-service\n          port: 50051\n\n    # Canary deployment for new service version\n    - matches:\n        - method:\n            service: user.UserService\n        headers:\n          - name: x-canary\n            value: \"true\"\n      backendRefs:\n        - name: user-service-canary\n          port: 50051\n\n    # Production user service\n    - matches:\n        - method:\n            service: user.UserService\n      backendRefs:\n        - name: user-service\n          port: 50051\n          weight: 95\n        - name: user-service-canary\n          port: 50051\n          weight: 5\n\n    # Order service\n    - matches:\n        - method:\n            service: order.OrderService\n      backendRefs:\n        - name: order-service\n          port: 50051\n\n    # Default fallback\n    - backendRefs:\n        - name: default-grpc-backend\n          port: 50051\n</code></pre>"},{"location":"gateway-api/grpcroute/#testing-with-grpcurl","title":"Testing with grpcurl","text":"<p>Test your GRPCRoute configuration:</p> <pre><code># List services (requires reflection)\ngrpcurl -plaintext grpc.example.com:80 list\n\n# Call a method\ngrpcurl -plaintext \\\n  -d '{\"name\": \"World\"}' \\\n  grpc.example.com:80 \\\n  helloworld.Greeter/SayHello\n\n# With custom header\ngrpcurl -plaintext \\\n  -H 'x-tenant-id: acme' \\\n  -d '{}' \\\n  grpc.example.com:80 \\\n  user.UserService/GetUser\n</code></pre>"},{"location":"gateway-api/grpcroute/#next-steps","title":"Next Steps","text":"<ul> <li>Set up ReferenceGrant for cross-namespace routing</li> <li>Review HTTPRoute for HTTP traffic</li> <li>Check Limitations for unsupported features</li> </ul>"},{"location":"gateway-api/httproute/","title":"HTTPRoute","text":"<p>HTTPRoute defines HTTP routing rules for traffic entering through a Gateway.</p>"},{"location":"gateway-api/httproute/#basic-example","title":"Basic Example","text":"<pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: simple-route\n  namespace: default\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - app.example.com\n  rules:\n    - backendRefs:\n        - name: my-service\n          port: 80\n</code></pre>"},{"location":"gateway-api/httproute/#path-matching","title":"Path Matching","text":""},{"location":"gateway-api/httproute/#pathprefix","title":"PathPrefix","text":"<p>Match requests starting with a path prefix:</p> <pre><code>rules:\n  - matches:\n      - path:\n          type: PathPrefix\n          value: /api\n    backendRefs:\n      - name: api-service\n        port: 8080\n</code></pre>"},{"location":"gateway-api/httproute/#exact-path","title":"Exact Path","text":"<p>Match requests with exact path:</p> <pre><code>rules:\n  - matches:\n      - path:\n          type: Exact\n          value: /health\n    backendRefs:\n      - name: health-service\n        port: 8080\n</code></pre>"},{"location":"gateway-api/httproute/#regular-expression","title":"Regular Expression","text":"<p>Match paths using regex patterns:</p> <pre><code>rules:\n  - matches:\n      - path:\n          type: RegularExpression\n          value: \"/users/[0-9]+\"\n    backendRefs:\n      - name: user-service\n        port: 8080\n</code></pre> <p>Regex Performance</p> <p>Complex regex patterns can impact routing performance. Use PathPrefix or Exact matching when possible.</p>"},{"location":"gateway-api/httproute/#header-matching","title":"Header Matching","text":"<p>Route based on HTTP headers:</p> <pre><code>rules:\n  - matches:\n      - headers:\n          - name: X-Environment\n            value: staging\n    backendRefs:\n      - name: staging-service\n        port: 8080\n  - matches:\n      - headers:\n          - name: X-Environment\n            value: production\n    backendRefs:\n      - name: production-service\n        port: 8080\n</code></pre>"},{"location":"gateway-api/httproute/#regex-header-matching","title":"Regex Header Matching","text":"<pre><code>rules:\n  - matches:\n      - headers:\n          - name: X-Request-ID\n            type: RegularExpression\n            value: \"^[a-f0-9]{32}$\"\n    backendRefs:\n      - name: traced-service\n        port: 8080\n</code></pre>"},{"location":"gateway-api/httproute/#method-matching","title":"Method Matching","text":"<p>Route based on HTTP method:</p> <pre><code>rules:\n  - matches:\n      - method: GET\n        path:\n          type: PathPrefix\n          value: /api/v1\n    backendRefs:\n      - name: read-api\n        port: 8080\n  - matches:\n      - method: POST\n        path:\n          type: PathPrefix\n          value: /api/v1\n    backendRefs:\n      - name: write-api\n        port: 8080\n</code></pre>"},{"location":"gateway-api/httproute/#query-parameter-matching","title":"Query Parameter Matching","text":"<p>Route based on query parameters:</p> <pre><code>rules:\n  - matches:\n      - queryParams:\n          - name: version\n            value: v2\n    backendRefs:\n      - name: api-v2\n        port: 8080\n  - backendRefs:\n      - name: api-v1\n        port: 8080\n</code></pre>"},{"location":"gateway-api/httproute/#regex-query-matching","title":"Regex Query Matching","text":"<pre><code>rules:\n  - matches:\n      - queryParams:\n          - name: id\n            type: RegularExpression\n            value: \"^[0-9]+$\"\n    backendRefs:\n      - name: numeric-id-service\n        port: 8080\n</code></pre>"},{"location":"gateway-api/httproute/#multiple-match-conditions","title":"Multiple Match Conditions","text":"<p>Combine multiple match conditions (AND logic within a match):</p> <pre><code>rules:\n  - matches:\n      - path:\n          type: PathPrefix\n          value: /api\n        headers:\n          - name: X-API-Version\n            value: \"2\"\n        method: POST\n    backendRefs:\n      - name: api-v2-write\n        port: 8080\n</code></pre>"},{"location":"gateway-api/httproute/#multiple-matches-or-logic","title":"Multiple Matches (OR logic)","text":"<p>Multiple matches within a rule use OR logic:</p> <pre><code>rules:\n  - matches:\n      - path:\n          type: Exact\n          value: /health\n      - path:\n          type: Exact\n          value: /ready\n    backendRefs:\n      - name: health-service\n        port: 8080\n</code></pre>"},{"location":"gateway-api/httproute/#weighted-backends","title":"Weighted Backends","text":"<p>Split traffic between multiple backends:</p> <pre><code>rules:\n  - backendRefs:\n      - name: service-v1\n        port: 8080\n        weight: 90\n      - name: service-v2\n        port: 8080\n        weight: 10\n</code></pre>"},{"location":"gateway-api/httproute/#request-timeouts","title":"Request Timeouts","text":"<p>Configure per-rule request timeouts:</p> <pre><code>rules:\n  - matches:\n      - path:\n          type: PathPrefix\n          value: /slow-api\n    backendRefs:\n      - name: slow-service\n        port: 8080\n    timeouts:\n      request: \"60s\"\n</code></pre>"},{"location":"gateway-api/httproute/#multiple-hostnames","title":"Multiple Hostnames","text":"<p>Route multiple hostnames to the same backend:</p> <pre><code>spec:\n  hostnames:\n    - app.example.com\n    - www.example.com\n    - \"*.staging.example.com\"\n  rules:\n    - backendRefs:\n        - name: web-app\n          port: 80\n</code></pre>"},{"location":"gateway-api/httproute/#cross-namespace-backend","title":"Cross-Namespace Backend","text":"<p>Reference a service in another namespace (requires ReferenceGrant):</p> <pre><code>rules:\n  - backendRefs:\n      - name: shared-service\n        namespace: shared-services\n        port: 8080\n</code></pre> <p>See ReferenceGrant for setup.</p>"},{"location":"gateway-api/httproute/#complete-example","title":"Complete Example","text":"<pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: comprehensive-route\n  namespace: default\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - api.example.com\n  rules:\n    # Health check endpoint\n    - matches:\n        - path:\n            type: Exact\n            value: /health\n      backendRefs:\n        - name: health-service\n          port: 8080\n      timeouts:\n        request: \"5s\"\n\n    # API v2 with canary\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api/v2\n      backendRefs:\n        - name: api-v2-stable\n          port: 8080\n          weight: 95\n        - name: api-v2-canary\n          port: 8080\n          weight: 5\n\n    # API v1 (default)\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api\n      backendRefs:\n        - name: api-v1\n          port: 8080\n      timeouts:\n        request: \"30s\"\n\n    # Default fallback\n    - backendRefs:\n        - name: default-backend\n          port: 80\n</code></pre>"},{"location":"gateway-api/httproute/#next-steps","title":"Next Steps","text":"<ul> <li>Configure GRPCRoute for gRPC services</li> <li>Set up ReferenceGrant for cross-namespace routing</li> <li>Review Limitations for unsupported features</li> </ul>"},{"location":"gateway-api/limitations/","title":"Limitations","text":"<p>Current limitations and unsupported features in Pingora Gateway Controller.</p>"},{"location":"gateway-api/limitations/#unsupported-features","title":"Unsupported Features","text":""},{"location":"gateway-api/limitations/#httproute-filters","title":"HTTPRoute Filters","text":"<p>The following HTTPRoute filters are not currently supported:</p> Filter Status Alternative RequestHeaderModifier Not Supported Backend handling ResponseHeaderModifier Not Supported Backend handling RequestRedirect Not Supported Backend handling URLRewrite Not Supported Backend handling RequestMirror Not Supported - ExtensionRef Not Supported - <p>Future Support</p> <p>Filter support is planned for future releases. Track progress in GitHub Issues.</p>"},{"location":"gateway-api/limitations/#tls-configuration","title":"TLS Configuration","text":"Feature Status Notes TLS termination Planned Future release TLS passthrough Not Planned Backend handles TLS mTLS Planned Client certificate validation Certificate rotation Planned Automatic Secret reload"},{"location":"gateway-api/limitations/#backend-types","title":"Backend Types","text":"<p>Only Kubernetes Service backends are supported:</p> Backend Type Status Service Supported External addresses Not Supported Custom backends Not Supported"},{"location":"gateway-api/limitations/#gateway-features","title":"Gateway Features","text":"Feature Status Notes Multiple Gateways Supported Same GatewayClass Gateway merge Not Supported Use single Gateway Infrastructure Not Supported -"},{"location":"gateway-api/limitations/#listener-features","title":"Listener Features","text":"Feature Status Notes HTTP Supported Default HTTPS Planned TLS termination TLS Planned Passthrough Allowed routes Partial Namespace selector only"},{"location":"gateway-api/limitations/#known-issues","title":"Known Issues","text":""},{"location":"gateway-api/limitations/#route-priority","title":"Route Priority","text":"<p>When multiple routes match a request, the order of evaluation follows Gateway API specification:</p> <ol> <li>Exact path matches before prefix matches</li> <li>Longer prefixes before shorter prefixes</li> <li>Header matches add specificity</li> <li>Method matches add specificity</li> </ol> <p>Regex Priority</p> <p>Regex path matches have lower priority than exact and prefix matches. This may differ from some other implementations.</p>"},{"location":"gateway-api/limitations/#backend-resolution","title":"Backend Resolution","text":"<ul> <li>Backend services must have at least one ready endpoint</li> <li>DNS resolution uses cluster domain (auto-detected or configured)</li> <li>Service ports must be explicitly specified</li> </ul>"},{"location":"gateway-api/limitations/#cross-namespace-references","title":"Cross-Namespace References","text":"<ul> <li>ReferenceGrant is required for all cross-namespace references</li> <li>Controller does not cache ReferenceGrant - changes apply immediately</li> <li>Deleting ReferenceGrant immediately breaks affected routes</li> </ul>"},{"location":"gateway-api/limitations/#resource-limits","title":"Resource Limits","text":"Resource Limit Notes Routes per Gateway No hard limit Performance degrades with thousands Rules per Route No hard limit Keep reasonable for maintainability Backends per Rule No hard limit - Hostnames per Route No hard limit -"},{"location":"gateway-api/limitations/#performance-considerations","title":"Performance Considerations","text":""},{"location":"gateway-api/limitations/#route-sync","title":"Route Sync","text":"<ul> <li>Routes are synced to Pingora proxy via gRPC</li> <li>Large configurations may take longer to sync</li> <li>Consider splitting routes across multiple HTTPRoute resources</li> </ul>"},{"location":"gateway-api/limitations/#regex-matching","title":"Regex Matching","text":"<ul> <li>Regex patterns are compiled at sync time</li> <li>Complex patterns impact matching performance</li> <li>Use exact or prefix matching when possible</li> </ul>"},{"location":"gateway-api/limitations/#memory-usage","title":"Memory Usage","text":"<ul> <li>Controller memory scales with number of watched resources</li> <li>Proxy memory scales with active connections and route count</li> <li>Monitor resource usage in production</li> </ul>"},{"location":"gateway-api/limitations/#workarounds","title":"Workarounds","text":""},{"location":"gateway-api/limitations/#header-modification","title":"Header Modification","text":"<p>Use a sidecar or middleware in your application:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nspec:\n  template:\n    spec:\n      containers:\n        - name: app\n          # Your application\n        - name: header-modifier\n          image: envoyproxy/envoy:v1.28.0\n          # Configure Envoy for header modification\n</code></pre>"},{"location":"gateway-api/limitations/#url-rewriting","title":"URL Rewriting","text":"<p>Handle URL rewriting in your application code or use a reverse proxy sidecar.</p>"},{"location":"gateway-api/limitations/#request-mirroring","title":"Request Mirroring","text":"<p>Use service mesh features (Istio, Linkerd) if request mirroring is required.</p>"},{"location":"gateway-api/limitations/#roadmap","title":"Roadmap","text":"<p>Features planned for future releases:</p> <ol> <li>TLS Support - HTTPS listeners with certificate management</li> <li>Filters - Request/response modification</li> <li>Policy Attachment - Gateway API Policy resources</li> <li>TCPRoute/UDPRoute - Layer 4 routing</li> </ol> <p>Track development progress on GitHub.</p>"},{"location":"gateway-api/limitations/#reporting-issues","title":"Reporting Issues","text":"<p>If you encounter issues or need features not listed here:</p> <ol> <li>Check existing issues</li> <li>Create a new issue with:</li> <li>Clear description of the problem</li> <li>Expected vs actual behavior</li> <li>Minimal reproduction steps</li> <li>Controller and Gateway API versions</li> </ol>"},{"location":"gateway-api/limitations/#next-steps","title":"Next Steps","text":"<ul> <li>Review Supported Resources for current capabilities</li> <li>Check Troubleshooting for common issues</li> </ul>"},{"location":"gateway-api/referencegrant/","title":"ReferenceGrant","text":"<p>ReferenceGrant enables cross-namespace references between Gateway API resources.</p>"},{"location":"gateway-api/referencegrant/#overview","title":"Overview","text":"<p>By default, Gateway API resources can only reference resources in the same namespace. ReferenceGrant allows explicit permission for cross-namespace references.</p> <pre><code>graph LR\n    subgraph namespace-a\n        HR[HTTPRoute]\n    end\n\n    subgraph namespace-b\n        RG[ReferenceGrant]\n        SVC[Service]\n    end\n\n    HR --&gt;|backendRef| SVC\n    RG -.-&gt;|allows| HR</code></pre>"},{"location":"gateway-api/referencegrant/#basic-example","title":"Basic Example","text":"<p>Allow HTTPRoutes from <code>default</code> namespace to reference Services in <code>backend</code>:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1beta1\nkind: ReferenceGrant\nmetadata:\n  name: allow-default-to-backend\n  namespace: backend\nspec:\n  from:\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      namespace: default\n  to:\n    - group: \"\"\n      kind: Service\n</code></pre>"},{"location":"gateway-api/referencegrant/#use-cases","title":"Use Cases","text":""},{"location":"gateway-api/referencegrant/#shared-backend-services","title":"Shared Backend Services","text":"<p>Multiple applications routing to a shared service:</p> <pre><code># In shared-services namespace\napiVersion: gateway.networking.k8s.io/v1beta1\nkind: ReferenceGrant\nmetadata:\n  name: allow-app-routes\n  namespace: shared-services\nspec:\n  from:\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      namespace: app-a\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      namespace: app-b\n  to:\n    - group: \"\"\n      kind: Service\n</code></pre>"},{"location":"gateway-api/referencegrant/#central-gateway","title":"Central Gateway","text":"<p>Allow routes from multiple namespaces to use a central Gateway:</p> <pre><code># In pingora-system namespace\napiVersion: gateway.networking.k8s.io/v1beta1\nkind: ReferenceGrant\nmetadata:\n  name: allow-app-routes-to-gateway\n  namespace: pingora-system\nspec:\n  from:\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      namespace: app-production\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      namespace: app-staging\n  to:\n    - group: gateway.networking.k8s.io\n      kind: Gateway\n</code></pre>"},{"location":"gateway-api/referencegrant/#grpcroute-cross-namespace","title":"GRPCRoute Cross-Namespace","text":"<p>Allow GRPCRoutes to reference services:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1beta1\nkind: ReferenceGrant\nmetadata:\n  name: allow-grpc-routes\n  namespace: grpc-services\nspec:\n  from:\n    - group: gateway.networking.k8s.io\n      kind: GRPCRoute\n      namespace: default\n  to:\n    - group: \"\"\n      kind: Service\n</code></pre>"},{"location":"gateway-api/referencegrant/#complete-example","title":"Complete Example","text":""},{"location":"gateway-api/referencegrant/#namespace-setup","title":"Namespace Setup","text":"<pre><code># Create namespaces\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: frontend\n---\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: api-backend\n</code></pre>"},{"location":"gateway-api/referencegrant/#backend-service","title":"Backend Service","text":"<pre><code># In api-backend namespace\napiVersion: v1\nkind: Service\nmetadata:\n  name: api-service\n  namespace: api-backend\nspec:\n  ports:\n    - port: 8080\n  selector:\n    app: api\n</code></pre>"},{"location":"gateway-api/referencegrant/#referencegrant_1","title":"ReferenceGrant","text":"<pre><code># In api-backend namespace\napiVersion: gateway.networking.k8s.io/v1beta1\nkind: ReferenceGrant\nmetadata:\n  name: allow-frontend-routes\n  namespace: api-backend\nspec:\n  from:\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      namespace: frontend\n  to:\n    - group: \"\"\n      kind: Service\n</code></pre>"},{"location":"gateway-api/referencegrant/#httproute","title":"HTTPRoute","text":"<pre><code># In frontend namespace\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: frontend-route\n  namespace: frontend\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - app.example.com\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /api\n      backendRefs:\n        - name: api-service\n          namespace: api-backend\n          port: 8080\n    - backendRefs:\n        - name: frontend-service\n          port: 80\n</code></pre>"},{"location":"gateway-api/referencegrant/#wildcard-namespaces","title":"Wildcard Namespaces","text":"<p>Allow all namespaces (use with caution):</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1beta1\nkind: ReferenceGrant\nmetadata:\n  name: allow-all-namespaces\n  namespace: shared-services\nspec:\n  from:\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      # Omit namespace to allow all\n  to:\n    - group: \"\"\n      kind: Service\n</code></pre> <p>Security Warning</p> <p>Omitting the namespace field allows references from all namespaces. This should only be used when necessary and with proper consideration.</p>"},{"location":"gateway-api/referencegrant/#troubleshooting","title":"Troubleshooting","text":""},{"location":"gateway-api/referencegrant/#route-not-accepted","title":"Route Not Accepted","text":"<p>Check if ReferenceGrant exists in target namespace:</p> <pre><code>kubectl get referencegrant --namespace api-backend\n</code></pre>"},{"location":"gateway-api/referencegrant/#verify-reference-is-allowed","title":"Verify Reference is Allowed","text":"<p>Check HTTPRoute status for reference errors:</p> <pre><code>kubectl get httproute frontend-route --namespace frontend --output yaml\n</code></pre> <p>Look for <code>ResolvedRefs</code> condition:</p> <pre><code>status:\n  parents:\n    - conditions:\n        - type: ResolvedRefs\n          status: \"False\"\n          reason: RefNotPermitted\n          message: \"Reference to api-backend/api-service not permitted\"\n</code></pre>"},{"location":"gateway-api/referencegrant/#common-issues","title":"Common Issues","text":"<ol> <li>ReferenceGrant in wrong namespace - Must be in the target namespace</li> <li>Wrong <code>from</code> kind - Must match the referencing resource type</li> <li>Missing namespace in <code>from</code> - Required for specific namespace access</li> <li>Wrong <code>to</code> group - Core resources use empty string <code>\"\"</code></li> </ol>"},{"location":"gateway-api/referencegrant/#security-considerations","title":"Security Considerations","text":"<ul> <li>Principle of least privilege: Grant only necessary permissions</li> <li>Namespace isolation: Use specific namespace names, not wildcards</li> <li>Audit ReferenceGrants: Regularly review cross-namespace permissions</li> <li>RBAC: Control who can create ReferenceGrants</li> </ul>"},{"location":"gateway-api/referencegrant/#next-steps","title":"Next Steps","text":"<ul> <li>Review Limitations for unsupported features</li> <li>Set up Cross-Namespace Routing Guide</li> </ul>"},{"location":"gateway-api/supported-resources/","title":"Supported Resources","text":"<p>This page documents Gateway API resource support in Pingora Gateway Controller.</p>"},{"location":"gateway-api/supported-resources/#core-resources","title":"Core Resources","text":"Resource Status Notes GatewayClass Supported Single GatewayClass per controller Gateway Supported Multiple listeners supported HTTPRoute Supported Full match support GRPCRoute Supported Service/method matching ReferenceGrant Supported Cross-namespace references"},{"location":"gateway-api/supported-resources/#httproute-features","title":"HTTPRoute Features","text":""},{"location":"gateway-api/supported-resources/#match-types","title":"Match Types","text":"Match Type Status Notes Path (Exact) Supported Exact path matching Path (PathPrefix) Supported Prefix matching Path (RegularExpression) Supported Regex patterns Headers (Exact) Supported Exact value match Headers (RegularExpression) Supported Regex patterns QueryParams (Exact) Supported Exact value match QueryParams (RegularExpression) Supported Regex patterns Method Supported HTTP method filtering"},{"location":"gateway-api/supported-resources/#backend-features","title":"Backend Features","text":"Feature Status Notes Service backends Supported Kubernetes Service only Cross-namespace backends Supported With ReferenceGrant Weighted backends Supported Traffic splitting Port specification Supported Required for Service"},{"location":"gateway-api/supported-resources/#route-features","title":"Route Features","text":"Feature Status Notes Multiple hostnames Supported Per-route hostnames Multiple rules Supported Ordered rule evaluation Request timeouts Supported Per-rule timeout Filters Not Supported See Limitations"},{"location":"gateway-api/supported-resources/#grpcroute-features","title":"GRPCRoute Features","text":""},{"location":"gateway-api/supported-resources/#match-types_1","title":"Match Types","text":"Match Type Status Notes Method (Exact) Supported Service + method name Method (RegularExpression) Supported Regex patterns Headers (Exact) Supported Exact value match Headers (RegularExpression) Supported Regex patterns"},{"location":"gateway-api/supported-resources/#backend-features_1","title":"Backend Features","text":"Feature Status Notes Service backends Supported Kubernetes Service only Cross-namespace backends Supported With ReferenceGrant Weighted backends Supported Traffic splitting"},{"location":"gateway-api/supported-resources/#gateway-features","title":"Gateway Features","text":""},{"location":"gateway-api/supported-resources/#listeners","title":"Listeners","text":"Feature Status Notes HTTP protocol Supported Default listener HTTPS protocol Planned TLS termination gRPC protocol Supported Via GRPCRoute Multiple listeners Supported Same or different ports"},{"location":"gateway-api/supported-resources/#tls-configuration","title":"TLS Configuration","text":"Feature Status Notes TLS termination Planned Future release TLS passthrough Not Planned Backend handles TLS Certificate rotation Planned Secret watch"},{"location":"gateway-api/supported-resources/#referencegrant","title":"ReferenceGrant","text":"Feature Status Notes Service references Supported Cross-namespace backends Secret references Planned For TLS configuration Gateway references Supported Cross-namespace parentRef"},{"location":"gateway-api/supported-resources/#status-updates","title":"Status Updates","text":"<p>The controller updates resource status to reflect configuration state:</p>"},{"location":"gateway-api/supported-resources/#gateway-status","title":"Gateway Status","text":"<pre><code>status:\n  conditions:\n    - type: Accepted\n      status: \"True\"\n    - type: Programmed\n      status: \"True\"\n  listeners:\n    - name: http\n      conditions:\n        - type: Accepted\n          status: \"True\"\n</code></pre>"},{"location":"gateway-api/supported-resources/#httproute-status","title":"HTTPRoute Status","text":"<pre><code>status:\n  parents:\n    - parentRef:\n        name: pingora-gateway\n        namespace: pingora-system\n      conditions:\n        - type: Accepted\n          status: \"True\"\n        - type: ResolvedRefs\n          status: \"True\"\n</code></pre>"},{"location":"gateway-api/supported-resources/#version-compatibility","title":"Version Compatibility","text":"Gateway API Version Controller Version Status v1.4.1 v0.x.x Supported v1.3.x v0.x.x Supported v1.2.x v0.x.x Partial v1.1.x v0.x.x Partial &lt; v1.1.0 - Not Supported <p>Recommended Version</p> <p>Use Gateway API v1.4.1 for full feature support.</p>"},{"location":"gateway-api/supported-resources/#next-steps","title":"Next Steps","text":"<ul> <li>Configure HTTPRoute for HTTP routing</li> <li>Configure GRPCRoute for gRPC services</li> <li>Review Limitations for unsupported features</li> </ul>"},{"location":"getting-started/","title":"Getting Started","text":"<p>This section covers everything you need to get the Pingora Gateway Controller running in your Kubernetes cluster.</p>"},{"location":"getting-started/#overview","title":"Overview","text":"<p>The controller implements the Gateway API for a Pingora-based reverse proxy. Before installing, you need:</p> <ol> <li>A Kubernetes cluster with Gateway API CRDs installed</li> <li>Helm 3.x for installation (recommended)</li> <li>Network connectivity between controller and backend services</li> </ol>"},{"location":"getting-started/#sections","title":"Sections","text":"<ul> <li> <p> Prerequisites</p> <p>Required components, Kubernetes version, and Gateway API CRDs setup.</p> <p> Prerequisites</p> </li> <li> <p> Installation</p> <p>Install the controller and proxy using Helm chart with all configuration options.</p> <p> Installation</p> </li> <li> <p> Quick Start</p> <p>Create your first HTTPRoute and expose a service through Pingora proxy.</p> <p> Quick Start</p> </li> </ul>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<p>After completing the getting started guide:</p> <ul> <li>Learn about Configuration options</li> <li>Explore Gateway API features and examples</li> <li>Set up Monitoring for production deployments</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>This guide covers installing the Pingora Gateway Controller using Helm.</p>"},{"location":"getting-started/installation/#helm-installation","title":"Helm Installation","text":"<p>Helm is the recommended installation method. It handles CRD installation, RBAC setup, and provides a simple upgrade path.</p>"},{"location":"getting-started/installation/#basic-installation","title":"Basic Installation","text":"<pre><code>helm install pingora-gateway-controller \\\n  oci://ghcr.io/lexfrei/pingora-gateway-controller/chart \\\n  --namespace pingora-system \\\n  --create-namespace\n</code></pre> <p>This installs both the controller and the Pingora proxy with default settings.</p>"},{"location":"getting-started/installation/#installation-with-values-file","title":"Installation with Values File","text":"<p>Create a <code>values.yaml</code> file for customization:</p> <pre><code># Controller settings\ncontroller:\n  gatewayClassName: \"pingora\"\n  logLevel: \"info\"\n  logFormat: \"json\"\n\n# Enable leader election for HA deployments\nleaderElection:\n  enabled: true\n\n# Multiple controller replicas for high availability\nreplicaCount: 2\n\n# Proxy settings\nproxy:\n  enabled: true\n  replicaCount: 3\n  resources:\n    limits:\n      cpu: 1\n      memory: 1Gi\n    requests:\n      cpu: 200m\n      memory: 256Mi\n\n# Enable Prometheus ServiceMonitor\nserviceMonitor:\n  enabled: true\n</code></pre> <p>Then install:</p> <pre><code>helm install pingora-gateway-controller \\\n  oci://ghcr.io/lexfrei/pingora-gateway-controller/chart \\\n  --namespace pingora-system \\\n  --create-namespace \\\n  --values values.yaml\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>Check that the controller is running:</p> <pre><code>kubectl get pods --namespace pingora-system\n</code></pre> <p>Expected output:</p> <pre><code>NAME                                                      READY   STATUS    RESTARTS   AGE\npingora-gateway-controller-7d8f9b6c5d-x2j9k               1/1     Running   0          30s\npingora-gateway-controller-proxy-5c4d8b7f6c-m8n3l         1/1     Running   0          30s\npingora-gateway-controller-proxy-5c4d8b7f6c-k9p2q         1/1     Running   0          30s\n</code></pre> <p>Check GatewayClass:</p> <pre><code>kubectl get gatewayclass pingora\n</code></pre> <p>Expected output:</p> <pre><code>NAME      CONTROLLER                              ACCEPTED   AGE\npingora   pingora.k8s.lex.la/gateway-controller   True       30s\n</code></pre> <p>Check Gateway:</p> <pre><code>kubectl get gateway --namespace pingora-system\n</code></pre>"},{"location":"getting-started/installation/#upgrading","title":"Upgrading","text":"<p>To upgrade to a newer version:</p> <pre><code>helm upgrade pingora-gateway-controller \\\n  oci://ghcr.io/lexfrei/pingora-gateway-controller/chart \\\n  --namespace pingora-system \\\n  --values values.yaml\n</code></pre>"},{"location":"getting-started/installation/#uninstalling","title":"Uninstalling","text":"<p>To remove the controller:</p> <pre><code>helm uninstall pingora-gateway-controller \\\n  --namespace pingora-system\n</code></pre> <p>Cleanup</p> <p>Uninstalling the Helm release will remove the controller and proxy pods. Gateway and HTTPRoute resources in other namespaces will remain but become non-functional. Clean them up if no longer needed.</p>"},{"location":"getting-started/installation/#manual-installation","title":"Manual Installation","text":"<p>For environments where Helm is not available, see Manual Installation for raw Kubernetes manifests.</p>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<p>After installation, proceed to Quick Start to create your first HTTPRoute.</p>"},{"location":"getting-started/prerequisites/","title":"Prerequisites","text":"<p>Before installing the Pingora Gateway Controller, ensure you have the following prerequisites in place.</p>"},{"location":"getting-started/prerequisites/#kubernetes-cluster","title":"Kubernetes Cluster","text":"<p>You need a Kubernetes cluster with:</p> <ul> <li>Kubernetes version 1.25 or later</li> <li><code>kubectl</code> configured to access the cluster</li> <li>Helm 3.x installed</li> </ul>"},{"location":"getting-started/prerequisites/#gateway-api-crds","title":"Gateway API CRDs","text":"<p>The controller requires Gateway API Custom Resource Definitions (CRDs) to be installed in your cluster:</p> <pre><code>kubectl apply --filename https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.4.1/standard-install.yaml\n</code></pre> <p>Version Compatibility</p> <p>The controller is tested with Gateway API v1.4.1. Using older versions may result in missing features or compatibility issues.</p> <p>Verify the CRDs are installed:</p> <pre><code>kubectl get crd gateways.gateway.networking.k8s.io\nkubectl get crd httproutes.gateway.networking.k8s.io\nkubectl get crd grpcroutes.gateway.networking.k8s.io\n</code></pre>"},{"location":"getting-started/prerequisites/#resource-requirements","title":"Resource Requirements","text":"<p>The controller and proxy have minimal resource requirements:</p> Component CPU Request Memory Request CPU Limit Memory Limit Controller 100m 128Mi 200m 256Mi Proxy (per replica) 100m 128Mi 500m 512Mi"},{"location":"getting-started/prerequisites/#network-requirements","title":"Network Requirements","text":"<p>The controller requires:</p> <ul> <li>Access to Kubernetes API server (in-cluster or kubeconfig)</li> <li>Network connectivity to Pingora proxy pods (gRPC on port 50051)</li> </ul> <p>The proxy requires:</p> <ul> <li>Network connectivity to backend services</li> <li>Inbound connectivity from clients (HTTP/HTTPS)</li> </ul>"},{"location":"getting-started/prerequisites/#optional-prometheus-operator","title":"Optional: Prometheus Operator","text":"<p>For metrics collection, the Prometheus Operator enables automatic service discovery:</p> <pre><code>kubectl apply --filename https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/main/bundle.yaml\n</code></pre> <p>See Monitoring for detailed setup instructions.</p>"},{"location":"getting-started/prerequisites/#next-steps","title":"Next Steps","text":"<p>Once you have all prerequisites in place, proceed to Installation.</p>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>This guide walks you through creating your first HTTPRoute to expose a Kubernetes service through Pingora proxy.</p>"},{"location":"getting-started/quickstart/#prerequisites","title":"Prerequisites","text":"<p>Ensure you have completed:</p> <ul> <li>Prerequisites - Gateway API CRDs installed</li> <li>Installation - Controller installed and running</li> </ul>"},{"location":"getting-started/quickstart/#deploy-a-sample-application","title":"Deploy a Sample Application","text":"<p>First, deploy a simple application to expose:</p> <pre><code>kubectl create deployment nginx --image=nginx:latest\nkubectl expose deployment nginx --port=80\n</code></pre>"},{"location":"getting-started/quickstart/#create-a-gateway","title":"Create a Gateway","text":"<p>Create a Gateway resource to define an entry point:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: pingora-gateway\n  namespace: pingora-system\nspec:\n  gatewayClassName: pingora\n  listeners:\n    - name: http\n      port: 80\n      protocol: HTTP\n</code></pre> <p>Apply the Gateway:</p> <pre><code>kubectl apply --filename gateway.yaml\n</code></pre>"},{"location":"getting-started/quickstart/#create-an-httproute","title":"Create an HTTPRoute","text":"<p>Create an HTTPRoute to expose the nginx service:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: nginx\n  namespace: default\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - nginx.example.com\n  rules:\n    - backendRefs:\n        - name: nginx\n          port: 80\n</code></pre> <p>Apply the route:</p> <pre><code>kubectl apply --filename httproute.yaml\n</code></pre>"},{"location":"getting-started/quickstart/#verify-the-route","title":"Verify the Route","text":"<p>Check that the HTTPRoute is accepted:</p> <pre><code>kubectl get httproute nginx\n</code></pre> <p>Expected output:</p> <pre><code>NAME    HOSTNAMES               AGE\nnginx   [\"nginx.example.com\"]   30s\n</code></pre> <p>Check the route status:</p> <pre><code>kubectl get httproute nginx --output jsonpath='{.status.parents[*].conditions}' | jq\n</code></pre> <p>Expected output includes <code>\"type\":\"Accepted\",\"status\":\"True\"</code>.</p>"},{"location":"getting-started/quickstart/#access-your-application","title":"Access Your Application","text":"<p>Get the proxy service IP:</p> <pre><code>kubectl get service --namespace pingora-system --selector app.kubernetes.io/component=proxy\n</code></pre> <p>For testing, use port-forward:</p> <pre><code>kubectl port-forward --namespace pingora-system service/pingora-gateway-controller-proxy 8080:80\n</code></pre> <p>Then access via curl:</p> <pre><code>curl --header \"Host: nginx.example.com\" http://localhost:8080\n</code></pre>"},{"location":"getting-started/quickstart/#path-based-routing","title":"Path-Based Routing","text":"<p>Route different paths to different services:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: api-routes\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - api.example.com\n  rules:\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /v1\n      backendRefs:\n        - name: api-v1\n          port: 8080\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /v2\n      backendRefs:\n        - name: api-v2\n          port: 8080\n</code></pre>"},{"location":"getting-started/quickstart/#header-based-routing","title":"Header-Based Routing","text":"<p>Route based on request headers:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: header-routes\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - app.example.com\n  rules:\n    - matches:\n        - headers:\n            - name: X-Version\n              value: beta\n      backendRefs:\n        - name: app-beta\n          port: 8080\n    - backendRefs:\n        - name: app-stable\n          port: 8080\n</code></pre>"},{"location":"getting-started/quickstart/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/quickstart/#route-not-accepted","title":"Route Not Accepted","text":"<p>Check controller logs:</p> <pre><code>kubectl logs --selector app.kubernetes.io/name=pingora-gateway-controller \\\n  --namespace pingora-system\n</code></pre> <p>Common issues:</p> <ul> <li>Gateway not found (wrong namespace or name in parentRefs)</li> <li>Service not found (wrong service name or namespace)</li> <li>GatewayClass not accepted</li> </ul>"},{"location":"getting-started/quickstart/#connection-refused","title":"Connection Refused","text":"<p>Verify the proxy is running and has endpoints:</p> <pre><code>kubectl get endpoints --namespace pingora-system\n</code></pre> <p>Check if backend service has healthy pods:</p> <pre><code>kubectl get pods --selector app=nginx\n</code></pre>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Learn about Configuration options</li> <li>Explore Gateway API features</li> <li>Set up Monitoring for production</li> </ul>"},{"location":"guides/","title":"Guides","text":"<p>Practical guides for common tasks and production deployments.</p>"},{"location":"guides/#available-guides","title":"Available Guides","text":"<ul> <li> <p> Cross-Namespace Routing</p> <p>Configure ReferenceGrant for cross-namespace service references and multi-tenant deployments.</p> <p> Cross-Namespace</p> </li> <li> <p> Monitoring</p> <p>Set up Prometheus metrics collection and Grafana dashboards for production visibility.</p> <p> Monitoring</p> </li> </ul>"},{"location":"guides/#quick-tips","title":"Quick Tips","text":""},{"location":"guides/#high-availability","title":"High Availability","text":"<p>For production deployments:</p> <pre><code>replicaCount: 2\nleaderElection:\n  enabled: true\nproxy:\n  replicaCount: 3\npodDisruptionBudget:\n  enabled: true\n  minAvailable: 1\n</code></pre>"},{"location":"guides/#resource-sizing","title":"Resource Sizing","text":"<p>Start with default resources and adjust based on:</p> <ul> <li>Number of routes and backends</li> <li>Request throughput</li> <li>Metrics from monitoring</li> </ul>"},{"location":"guides/#security","title":"Security","text":"<ul> <li>Enable NetworkPolicy to restrict traffic</li> <li>Use ReferenceGrant for cross-namespace access</li> <li>Run as non-root (default configuration)</li> </ul>"},{"location":"guides/#next-steps","title":"Next Steps","text":"<ul> <li>Set up Cross-Namespace Routing for multi-tenant environments</li> <li>Configure Monitoring for production observability</li> </ul>"},{"location":"guides/cross-namespace/","title":"Cross-Namespace Routing","text":"<p>This guide covers setting up cross-namespace routing for multi-tenant environments and shared services.</p>"},{"location":"guides/cross-namespace/#overview","title":"Overview","text":"<p>By default, HTTPRoute and GRPCRoute can only reference Services in the same namespace. ReferenceGrant enables cross-namespace references with explicit permissions.</p>"},{"location":"guides/cross-namespace/#use-cases","title":"Use Cases","text":""},{"location":"guides/cross-namespace/#shared-backend-services","title":"Shared Backend Services","text":"<p>Route traffic from multiple application namespaces to shared services:</p> <pre><code>graph LR\n    subgraph app-team-a\n        HR1[HTTPRoute]\n    end\n    subgraph app-team-b\n        HR2[HTTPRoute]\n    end\n    subgraph shared-services\n        RG[ReferenceGrant]\n        SVC[Shared Service]\n    end\n    HR1 --&gt;|backendRef| SVC\n    HR2 --&gt;|backendRef| SVC\n    RG -.-&gt;|allows| HR1\n    RG -.-&gt;|allows| HR2</code></pre>"},{"location":"guides/cross-namespace/#central-gateway-pattern","title":"Central Gateway Pattern","text":"<p>Single Gateway serving routes from multiple namespaces:</p> <pre><code>graph TD\n    subgraph pingora-system\n        GW[Gateway]\n        RG[ReferenceGrant]\n    end\n    subgraph app-a\n        HR1[HTTPRoute]\n    end\n    subgraph app-b\n        HR2[HTTPRoute]\n    end\n    HR1 --&gt;|parentRef| GW\n    HR2 --&gt;|parentRef| GW\n    RG -.-&gt;|allows| HR1\n    RG -.-&gt;|allows| HR2</code></pre>"},{"location":"guides/cross-namespace/#step-by-step-setup","title":"Step-by-Step Setup","text":""},{"location":"guides/cross-namespace/#1-create-namespaces","title":"1. Create Namespaces","text":"<pre><code>kubectl create namespace frontend\nkubectl create namespace api-backend\nkubectl create namespace shared-services\n</code></pre>"},{"location":"guides/cross-namespace/#2-deploy-backend-services","title":"2. Deploy Backend Services","text":"<pre><code># In shared-services namespace\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: auth-service\n  namespace: shared-services\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: auth-service\n  template:\n    metadata:\n      labels:\n        app: auth-service\n    spec:\n      containers:\n        - name: auth\n          image: your-auth-service:latest\n          ports:\n            - containerPort: 8080\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: auth-service\n  namespace: shared-services\nspec:\n  selector:\n    app: auth-service\n  ports:\n    - port: 8080\n</code></pre>"},{"location":"guides/cross-namespace/#3-create-referencegrant","title":"3. Create ReferenceGrant","text":"<p>Allow routes from frontend and api-backend to reference shared services:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1beta1\nkind: ReferenceGrant\nmetadata:\n  name: allow-app-routes\n  namespace: shared-services\nspec:\n  from:\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      namespace: frontend\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      namespace: api-backend\n  to:\n    - group: \"\"\n      kind: Service\n</code></pre>"},{"location":"guides/cross-namespace/#4-create-cross-namespace-httproute","title":"4. Create Cross-Namespace HTTPRoute","text":"<pre><code># In frontend namespace\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: frontend-routes\n  namespace: frontend\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - app.example.com\n  rules:\n    # Auth requests go to shared service\n    - matches:\n        - path:\n            type: PathPrefix\n            value: /auth\n      backendRefs:\n        - name: auth-service\n          namespace: shared-services\n          port: 8080\n\n    # Frontend requests stay in namespace\n    - backendRefs:\n        - name: frontend-service\n          port: 80\n</code></pre>"},{"location":"guides/cross-namespace/#5-verify-configuration","title":"5. Verify Configuration","text":"<p>Check route status:</p> <pre><code>kubectl get httproute frontend-routes --namespace frontend --output yaml\n</code></pre> <p>Look for <code>ResolvedRefs</code> condition:</p> <pre><code>status:\n  parents:\n    - conditions:\n        - type: ResolvedRefs\n          status: \"True\"\n          reason: ResolvedRefs\n</code></pre>"},{"location":"guides/cross-namespace/#multi-tenant-pattern","title":"Multi-Tenant Pattern","text":""},{"location":"guides/cross-namespace/#tenant-isolation","title":"Tenant Isolation","text":"<p>Each tenant has their own namespace with isolated routes:</p> <pre><code># Tenant A namespace\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: tenant-a\n  labels:\n    tenant: a\n---\n# Tenant B namespace\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: tenant-b\n  labels:\n    tenant: b\n</code></pre>"},{"location":"guides/cross-namespace/#central-gateway-referencegrant","title":"Central Gateway ReferenceGrant","text":"<p>Allow all tenant namespaces to use the central Gateway:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1beta1\nkind: ReferenceGrant\nmetadata:\n  name: allow-tenant-routes\n  namespace: pingora-system\nspec:\n  from:\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      namespace: tenant-a\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      namespace: tenant-b\n  to:\n    - group: gateway.networking.k8s.io\n      kind: Gateway\n</code></pre>"},{"location":"guides/cross-namespace/#tenant-routes","title":"Tenant Routes","text":"<p>Each tenant manages their own routes:</p> <pre><code># Tenant A route\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: tenant-a-routes\n  namespace: tenant-a\nspec:\n  parentRefs:\n    - name: pingora-gateway\n      namespace: pingora-system\n  hostnames:\n    - tenant-a.example.com\n  rules:\n    - backendRefs:\n        - name: tenant-a-service\n          port: 80\n</code></pre>"},{"location":"guides/cross-namespace/#rbac-for-referencegrant","title":"RBAC for ReferenceGrant","text":"<p>Control who can create ReferenceGrants:</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: referencegrant-admin\n  namespace: shared-services\nrules:\n  - apiGroups: [\"gateway.networking.k8s.io\"]\n    resources: [\"referencegrants\"]\n    verbs: [\"create\", \"update\", \"delete\", \"get\", \"list\", \"watch\"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: platform-team-referencegrant\n  namespace: shared-services\nsubjects:\n  - kind: Group\n    name: platform-team\n    apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: referencegrant-admin\n  apiGroup: rbac.authorization.k8s.io\n</code></pre>"},{"location":"guides/cross-namespace/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/cross-namespace/#resolvedrefs-failed","title":"ResolvedRefs Failed","text":"<pre><code>kubectl get httproute my-route --output jsonpath='{.status.parents[*].conditions}' | jq\n</code></pre> <p>Common causes:</p> <ul> <li>ReferenceGrant missing or in wrong namespace</li> <li>ReferenceGrant <code>from</code> doesn't match route namespace</li> <li>ReferenceGrant <code>to</code> doesn't match target resource</li> </ul>"},{"location":"guides/cross-namespace/#check-referencegrants","title":"Check ReferenceGrants","text":"<pre><code># List all ReferenceGrants\nkubectl get referencegrant --all-namespaces\n\n# Check specific grant\nkubectl describe referencegrant allow-app-routes --namespace shared-services\n</code></pre>"},{"location":"guides/cross-namespace/#best-practices","title":"Best Practices","text":"<ol> <li>Least Privilege: Grant only necessary permissions</li> <li>Explicit Namespaces: Always specify namespace in ReferenceGrant</li> <li>RBAC Control: Restrict who can create ReferenceGrants</li> <li>Documentation: Document cross-namespace dependencies</li> <li>Monitoring: Alert on ReferenceGrant changes</li> </ol>"},{"location":"guides/cross-namespace/#next-steps","title":"Next Steps","text":"<ul> <li>Set up Monitoring for production</li> <li>Review ReferenceGrant specification</li> </ul>"},{"location":"guides/monitoring/","title":"Monitoring","text":"<p>This guide covers setting up Prometheus metrics collection and Grafana dashboards for Pingora Gateway Controller.</p>"},{"location":"guides/monitoring/#overview","title":"Overview","text":"<p>The controller exposes Prometheus metrics for:</p> <ul> <li>Route synchronization performance</li> <li>gRPC communication with Pingora proxy</li> <li>Backend reference validation</li> <li>Error tracking</li> </ul>"},{"location":"guides/monitoring/#prometheus-setup","title":"Prometheus Setup","text":""},{"location":"guides/monitoring/#enable-servicemonitor","title":"Enable ServiceMonitor","text":"<p>If using Prometheus Operator, enable ServiceMonitor in Helm values:</p> <pre><code>serviceMonitor:\n  enabled: true\n  interval: \"30s\"\n  labels:\n    release: prometheus  # Match your Prometheus selector\n</code></pre>"},{"location":"guides/monitoring/#manual-prometheus-configuration","title":"Manual Prometheus Configuration","text":"<p>For standard Prometheus installations, add a scrape config:</p> <pre><code>scrape_configs:\n  - job_name: 'pingora-gateway-controller'\n    kubernetes_sd_configs:\n      - role: endpoints\n        namespaces:\n          names:\n            - pingora-system\n    relabel_configs:\n      - source_labels: [__meta_kubernetes_service_name]\n        action: keep\n        regex: pingora-gateway-controller\n      - source_labels: [__meta_kubernetes_endpoint_port_name]\n        action: keep\n        regex: metrics\n</code></pre>"},{"location":"guides/monitoring/#verify-metrics","title":"Verify Metrics","text":"<p>Check metrics are being scraped:</p> <pre><code>kubectl port-forward --namespace pingora-system \\\n  service/pingora-gateway-controller 8080:8080\n\ncurl http://localhost:8080/metrics\n</code></pre>"},{"location":"guides/monitoring/#available-metrics","title":"Available Metrics","text":""},{"location":"guides/monitoring/#sync-metrics","title":"Sync Metrics","text":"Metric Type Description <code>pingora_sync_duration_seconds</code> Histogram Duration of route synchronization <code>pingora_synced_routes</code> Gauge Number of synced routes by type <code>pingora_ingress_rules</code> Gauge Total ingress rules in proxy config <code>pingora_failed_backend_refs</code> Gauge Failed backend references by type <code>pingora_sync_errors_total</code> Counter Total sync errors by type"},{"location":"guides/monitoring/#ingress-build-metrics","title":"Ingress Build Metrics","text":"Metric Type Description <code>pingora_ingress_build_duration_seconds</code> Histogram Duration of ingress rule building <code>pingora_backend_ref_validation_total</code> Counter Backend ref validation results"},{"location":"guides/monitoring/#grpc-metrics","title":"gRPC Metrics","text":"Metric Type Description <code>pingora_grpc_duration_seconds</code> Histogram Duration of gRPC calls <code>pingora_grpc_calls_total</code> Counter Total gRPC calls by method and status <code>pingora_grpc_errors_total</code> Counter Total gRPC errors by method and type"},{"location":"guides/monitoring/#alerting-rules","title":"Alerting Rules","text":""},{"location":"guides/monitoring/#example-prometheusrule","title":"Example PrometheusRule","text":"<pre><code>apiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  name: pingora-gateway-alerts\n  namespace: pingora-system\n  labels:\n    release: prometheus\nspec:\n  groups:\n    - name: pingora-gateway\n      rules:\n        # Sync taking too long\n        - alert: PingoraSyncSlow\n          expr: |\n            histogram_quantile(0.95,\n              sum(rate(pingora_sync_duration_seconds_bucket[5m])) by (le)\n            ) &gt; 5\n          for: 5m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"Pingora sync is slow\"\n            description: \"95th percentile sync duration is {{ $value }}s\"\n\n        # High error rate\n        - alert: PingoraSyncErrors\n          expr: |\n            increase(pingora_sync_errors_total[5m]) &gt; 10\n          for: 5m\n          labels:\n            severity: critical\n          annotations:\n            summary: \"High Pingora sync error rate\"\n            description: \"{{ $value }} sync errors in last 5 minutes\"\n\n        # gRPC connection issues\n        - alert: PingoraGRPCErrors\n          expr: |\n            increase(pingora_grpc_errors_total[5m]) &gt; 5\n          for: 5m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"Pingora gRPC errors detected\"\n            description: \"{{ $value }} gRPC errors in last 5 minutes\"\n\n        # No routes synced\n        - alert: PingoraNoRoutes\n          expr: |\n            sum(pingora_synced_routes) == 0\n          for: 10m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"No routes synced\"\n            description: \"Controller has no synced routes for 10 minutes\"\n\n        # Failed backend references\n        - alert: PingoraFailedBackends\n          expr: |\n            sum(pingora_failed_backend_refs) &gt; 0\n          for: 5m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"Failed backend references\"\n            description: \"{{ $value }} backend references failed\"\n</code></pre>"},{"location":"guides/monitoring/#grafana-dashboard","title":"Grafana Dashboard","text":""},{"location":"guides/monitoring/#import-dashboard","title":"Import Dashboard","text":"<p>Create a dashboard with the following panels:</p>"},{"location":"guides/monitoring/#sync-performance","title":"Sync Performance","text":"<pre><code>{\n  \"title\": \"Sync Duration (p95)\",\n  \"type\": \"graph\",\n  \"targets\": [\n    {\n      \"expr\": \"histogram_quantile(0.95, sum(rate(pingora_sync_duration_seconds_bucket[5m])) by (le))\",\n      \"legendFormat\": \"p95\"\n    },\n    {\n      \"expr\": \"histogram_quantile(0.50, sum(rate(pingora_sync_duration_seconds_bucket[5m])) by (le))\",\n      \"legendFormat\": \"p50\"\n    }\n  ]\n}\n</code></pre>"},{"location":"guides/monitoring/#routes-overview","title":"Routes Overview","text":"<pre><code>{\n  \"title\": \"Synced Routes\",\n  \"type\": \"stat\",\n  \"targets\": [\n    {\n      \"expr\": \"sum(pingora_synced_routes) by (type)\",\n      \"legendFormat\": \"{{ type }}\"\n    }\n  ]\n}\n</code></pre>"},{"location":"guides/monitoring/#grpc-calls-rate","title":"gRPC Calls Rate","text":"<pre><code>{\n  \"title\": \"gRPC Calls/sec\",\n  \"type\": \"graph\",\n  \"targets\": [\n    {\n      \"expr\": \"sum(rate(pingora_grpc_calls_total[5m])) by (method, status)\",\n      \"legendFormat\": \"{{ method }} ({{ status }})\"\n    }\n  ]\n}\n</code></pre>"},{"location":"guides/monitoring/#error-rate","title":"Error Rate","text":"<pre><code>{\n  \"title\": \"Errors\",\n  \"type\": \"graph\",\n  \"targets\": [\n    {\n      \"expr\": \"sum(rate(pingora_sync_errors_total[5m])) by (error_type)\",\n      \"legendFormat\": \"Sync: {{ error_type }}\"\n    },\n    {\n      \"expr\": \"sum(rate(pingora_grpc_errors_total[5m])) by (error_type)\",\n      \"legendFormat\": \"gRPC: {{ error_type }}\"\n    }\n  ]\n}\n</code></pre>"},{"location":"guides/monitoring/#useful-queries","title":"Useful Queries","text":""},{"location":"guides/monitoring/#sync-success-rate","title":"Sync Success Rate","text":"<pre><code>sum(rate(pingora_grpc_calls_total{status=\"success\"}[5m])) /\nsum(rate(pingora_grpc_calls_total[5m]))\n</code></pre>"},{"location":"guides/monitoring/#average-sync-duration","title":"Average Sync Duration","text":"<pre><code>sum(rate(pingora_sync_duration_seconds_sum[5m])) /\nsum(rate(pingora_sync_duration_seconds_count[5m]))\n</code></pre>"},{"location":"guides/monitoring/#routes-by-type","title":"Routes by Type","text":"<pre><code>sum(pingora_synced_routes) by (type)\n</code></pre>"},{"location":"guides/monitoring/#backend-validation-failures","title":"Backend Validation Failures","text":"<pre><code>sum(rate(pingora_backend_ref_validation_total{result=\"failure\"}[5m])) by (reason)\n</code></pre>"},{"location":"guides/monitoring/#proxy-metrics","title":"Proxy Metrics","text":"<p>The Pingora proxy exposes its own metrics. See proxy documentation for available metrics and scrape configuration.</p>"},{"location":"guides/monitoring/#next-steps","title":"Next Steps","text":"<ul> <li>Set up Cross-Namespace Routing for multi-tenant environments</li> <li>Check Operations for troubleshooting</li> <li>Review Metrics Reference for complete metric list</li> </ul>"},{"location":"operations/","title":"Operations","text":"<p>This section covers operational aspects of running Pingora Gateway Controller in production.</p>"},{"location":"operations/#sections","title":"Sections","text":"<ul> <li> <p> Troubleshooting</p> <p>Common issues and their solutions for debugging controller and proxy problems.</p> <p> Troubleshooting</p> </li> <li> <p> Metrics Reference</p> <p>Complete reference of all Prometheus metrics exposed by the controller.</p> <p> Metrics</p> </li> <li> <p> Manual Installation</p> <p>Step-by-step guide for installing without Helm using raw Kubernetes manifests.</p> <p> Manual Installation</p> </li> </ul>"},{"location":"operations/#quick-commands","title":"Quick Commands","text":""},{"location":"operations/#check-controller-status","title":"Check Controller Status","text":"<pre><code>kubectl get pods --namespace pingora-system\nkubectl logs --selector app.kubernetes.io/name=pingora-gateway-controller \\\n  --namespace pingora-system --tail=100\n</code></pre>"},{"location":"operations/#check-route-status","title":"Check Route Status","text":"<pre><code>kubectl get httproutes --all-namespaces\nkubectl get grpcroutes --all-namespaces\n</code></pre>"},{"location":"operations/#check-gateway-status","title":"Check Gateway Status","text":"<pre><code>kubectl get gateway --namespace pingora-system --output yaml\n</code></pre>"},{"location":"operations/#check-pingoraconfig","title":"Check PingoraConfig","text":"<pre><code>kubectl get pingoraconfig --output wide\n</code></pre>"},{"location":"operations/#health-checks","title":"Health Checks","text":""},{"location":"operations/#controller-health","title":"Controller Health","text":"<pre><code>kubectl exec -it deployment/pingora-gateway-controller \\\n  --namespace pingora-system -- wget -qO- http://localhost:8081/healthz\n</code></pre>"},{"location":"operations/#proxy-health","title":"Proxy Health","text":"<pre><code>kubectl exec -it deployment/pingora-gateway-controller-proxy \\\n  --namespace pingora-system -- wget -qO- http://localhost:8081/health\n</code></pre>"},{"location":"operations/#next-steps","title":"Next Steps","text":"<ul> <li>Review Troubleshooting for common issues</li> <li>Check Metrics for monitoring setup</li> </ul>"},{"location":"operations/manual-installation/","title":"Manual Installation","text":"<p>Step-by-step guide for installing Pingora Gateway Controller without Helm.</p>"},{"location":"operations/manual-installation/#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes 1.25+</li> <li>kubectl configured</li> <li>Gateway API CRDs installed</li> </ul>"},{"location":"operations/manual-installation/#install-gateway-api-crds","title":"Install Gateway API CRDs","text":"<pre><code>kubectl apply --filename https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.4.1/standard-install.yaml\n</code></pre>"},{"location":"operations/manual-installation/#install-controller-crds","title":"Install Controller CRDs","text":"<p>Apply the PingoraConfig CRD:</p> <pre><code>kubectl apply --filename https://raw.githubusercontent.com/lexfrei/pingora-gateway-controller/master/charts/pingora-gateway-controller/crds/pingoraconfig-crd.yaml\n</code></pre>"},{"location":"operations/manual-installation/#create-namespace","title":"Create Namespace","text":"<pre><code>kubectl create namespace pingora-system\n</code></pre>"},{"location":"operations/manual-installation/#create-rbac-resources","title":"Create RBAC Resources","text":""},{"location":"operations/manual-installation/#service-account","title":"Service Account","text":"<pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: pingora-gateway-controller\n  namespace: pingora-system\n</code></pre>"},{"location":"operations/manual-installation/#clusterrole","title":"ClusterRole","text":"<pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: pingora-gateway-controller\nrules:\n  # Gateway API resources\n  - apiGroups: [\"gateway.networking.k8s.io\"]\n    resources: [\"gatewayclasses\", \"gateways\", \"httproutes\", \"grpcroutes\", \"referencegrants\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"gateway.networking.k8s.io\"]\n    resources: [\"gatewayclasses/status\", \"gateways/status\", \"httproutes/status\", \"grpcroutes/status\"]\n    verbs: [\"update\", \"patch\"]\n\n  # PingoraConfig CRD\n  - apiGroups: [\"pingora.k8s.lex.la\"]\n    resources: [\"pingoraconfigs\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"pingora.k8s.lex.la\"]\n    resources: [\"pingoraconfigs/status\"]\n    verbs: [\"update\", \"patch\"]\n\n  # Core resources\n  - apiGroups: [\"\"]\n    resources: [\"services\", \"endpoints\", \"secrets\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"create\", \"patch\"]\n\n  # Leader election\n  - apiGroups: [\"coordination.k8s.io\"]\n    resources: [\"leases\"]\n    verbs: [\"get\", \"create\", \"update\"]\n</code></pre>"},{"location":"operations/manual-installation/#clusterrolebinding","title":"ClusterRoleBinding","text":"<pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: pingora-gateway-controller\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: pingora-gateway-controller\nsubjects:\n  - kind: ServiceAccount\n    name: pingora-gateway-controller\n    namespace: pingora-system\n</code></pre> <p>Apply RBAC:</p> <pre><code>kubectl apply --filename rbac.yaml\n</code></pre>"},{"location":"operations/manual-installation/#deploy-controller","title":"Deploy Controller","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: pingora-gateway-controller\n  namespace: pingora-system\n  labels:\n    app.kubernetes.io/name: pingora-gateway-controller\n    app.kubernetes.io/component: controller\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: pingora-gateway-controller\n  template:\n    metadata:\n      labels:\n        app.kubernetes.io/name: pingora-gateway-controller\n        app.kubernetes.io/component: controller\n    spec:\n      serviceAccountName: pingora-gateway-controller\n      securityContext:\n        runAsNonRoot: true\n        runAsUser: 65534\n        seccompProfile:\n          type: RuntimeDefault\n      containers:\n        - name: controller\n          image: ghcr.io/lexfrei/pingora-gateway-controller:latest\n          args:\n            - --gateway-class-name=pingora\n            - --controller-name=pingora.k8s.lex.la/gateway-controller\n            - --metrics-addr=:8080\n            - --health-addr=:8081\n            - --log-level=info\n            - --log-format=json\n          ports:\n            - name: metrics\n              containerPort: 8080\n            - name: health\n              containerPort: 8081\n          livenessProbe:\n            httpGet:\n              path: /healthz\n              port: health\n            initialDelaySeconds: 15\n            periodSeconds: 20\n          readinessProbe:\n            httpGet:\n              path: /readyz\n              port: health\n            initialDelaySeconds: 5\n            periodSeconds: 10\n          resources:\n            limits:\n              cpu: 200m\n              memory: 256Mi\n            requests:\n              cpu: 100m\n              memory: 128Mi\n          securityContext:\n            allowPrivilegeEscalation: false\n            readOnlyRootFilesystem: true\n            capabilities:\n              drop:\n                - ALL\n          volumeMounts:\n            - name: tmp\n              mountPath: /tmp\n      volumes:\n        - name: tmp\n          emptyDir: {}\n</code></pre> <p>Apply controller:</p> <pre><code>kubectl apply --filename controller-deployment.yaml\n</code></pre>"},{"location":"operations/manual-installation/#deploy-proxy","title":"Deploy Proxy","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: pingora-gateway-controller-proxy\n  namespace: pingora-system\n  labels:\n    app.kubernetes.io/name: pingora-gateway-controller\n    app.kubernetes.io/component: proxy\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: pingora-gateway-controller\n      app.kubernetes.io/component: proxy\n  template:\n    metadata:\n      labels:\n        app.kubernetes.io/name: pingora-gateway-controller\n        app.kubernetes.io/component: proxy\n    spec:\n      securityContext:\n        runAsNonRoot: true\n        runAsUser: 65534\n        seccompProfile:\n          type: RuntimeDefault\n      containers:\n        - name: proxy\n          image: ghcr.io/lexfrei/pingora-proxy:latest\n          args:\n            - --log-level=info\n          ports:\n            - name: http\n              containerPort: 80\n            - name: grpc\n              containerPort: 50051\n            - name: health\n              containerPort: 8081\n          livenessProbe:\n            httpGet:\n              path: /health\n              port: health\n            initialDelaySeconds: 15\n            periodSeconds: 20\n          readinessProbe:\n            httpGet:\n              path: /health\n              port: health\n            initialDelaySeconds: 5\n            periodSeconds: 10\n          resources:\n            limits:\n              cpu: 500m\n              memory: 512Mi\n            requests:\n              cpu: 100m\n              memory: 128Mi\n          securityContext:\n            allowPrivilegeEscalation: false\n            readOnlyRootFilesystem: true\n            capabilities:\n              drop:\n                - ALL\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: pingora-gateway-controller-proxy\n  namespace: pingora-system\nspec:\n  selector:\n    app.kubernetes.io/name: pingora-gateway-controller\n    app.kubernetes.io/component: proxy\n  ports:\n    - name: http\n      port: 80\n      targetPort: 80\n    - name: grpc\n      port: 50051\n      targetPort: 50051\n</code></pre> <p>Apply proxy:</p> <pre><code>kubectl apply --filename proxy-deployment.yaml\n</code></pre>"},{"location":"operations/manual-installation/#create-gatewayclass","title":"Create GatewayClass","text":"<pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: GatewayClass\nmetadata:\n  name: pingora\nspec:\n  controllerName: pingora.k8s.lex.la/gateway-controller\n  parametersRef:\n    group: pingora.k8s.lex.la\n    kind: PingoraConfig\n    name: pingora-config\n</code></pre>"},{"location":"operations/manual-installation/#create-pingoraconfig","title":"Create PingoraConfig","text":"<pre><code>apiVersion: pingora.k8s.lex.la/v1alpha1\nkind: PingoraConfig\nmetadata:\n  name: pingora-config\nspec:\n  address: \"pingora-gateway-controller-proxy.pingora-system.svc.cluster.local:50051\"\n  connection:\n    connectTimeoutSeconds: 5\n    requestTimeoutSeconds: 30\n    maxRetries: 3\n</code></pre> <p>Apply configuration:</p> <pre><code>kubectl apply --filename gatewayclass.yaml\nkubectl apply --filename pingoraconfig.yaml\n</code></pre>"},{"location":"operations/manual-installation/#create-gateway","title":"Create Gateway","text":"<pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: pingora-gateway\n  namespace: pingora-system\nspec:\n  gatewayClassName: pingora\n  listeners:\n    - name: http\n      port: 80\n      protocol: HTTP\n</code></pre> <p>Apply Gateway:</p> <pre><code>kubectl apply --filename gateway.yaml\n</code></pre>"},{"location":"operations/manual-installation/#verify-installation","title":"Verify Installation","text":"<pre><code># Check pods\nkubectl get pods --namespace pingora-system\n\n# Check GatewayClass\nkubectl get gatewayclass pingora\n\n# Check Gateway\nkubectl get gateway --namespace pingora-system\n\n# Check PingoraConfig\nkubectl get pingoraconfig\n</code></pre>"},{"location":"operations/manual-installation/#create-controller-service-for-metrics","title":"Create Controller Service (for metrics)","text":"<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: pingora-gateway-controller\n  namespace: pingora-system\nspec:\n  selector:\n    app.kubernetes.io/name: pingora-gateway-controller\n    app.kubernetes.io/component: controller\n  ports:\n    - name: metrics\n      port: 8080\n    - name: health\n      port: 8081\n</code></pre>"},{"location":"operations/manual-installation/#cleanup","title":"Cleanup","text":"<p>To remove all resources:</p> <pre><code>kubectl delete namespace pingora-system\nkubectl delete clusterrole pingora-gateway-controller\nkubectl delete clusterrolebinding pingora-gateway-controller\nkubectl delete gatewayclass pingora\nkubectl delete pingoraconfig pingora-config\n</code></pre>"},{"location":"operations/manual-installation/#next-steps","title":"Next Steps","text":"<ul> <li>Create HTTPRoute to route traffic</li> <li>Set up Monitoring for production</li> </ul>"},{"location":"operations/metrics/","title":"Metrics Reference","text":"<p>Complete reference of Prometheus metrics exposed by Pingora Gateway Controller.</p>"},{"location":"operations/metrics/#endpoints","title":"Endpoints","text":"Component Port Path Controller 8080 <code>/metrics</code>"},{"location":"operations/metrics/#sync-metrics","title":"Sync Metrics","text":""},{"location":"operations/metrics/#pingora_sync_duration_seconds","title":"pingora_sync_duration_seconds","text":"<p>Duration of route synchronization to Pingora proxy.</p> Label Description <code>status</code> Sync result: <code>success</code>, <code>error</code> <p>Type: Histogram</p> <p>Buckets: 0.1, 0.25, 0.5, 1, 2.5, 5, 10, 30 seconds</p> <p>Example:</p> <pre><code># 95th percentile sync duration\nhistogram_quantile(0.95,\n  sum(rate(pingora_sync_duration_seconds_bucket[5m])) by (le)\n)\n\n# Average sync duration\nsum(rate(pingora_sync_duration_seconds_sum[5m])) /\nsum(rate(pingora_sync_duration_seconds_count[5m]))\n</code></pre>"},{"location":"operations/metrics/#pingora_synced_routes","title":"pingora_synced_routes","text":"<p>Number of routes synced by type.</p> Label Description <code>type</code> Route type: <code>HTTPRoute</code>, <code>GRPCRoute</code> <p>Type: Gauge</p> <p>Example:</p> <pre><code># Total routes by type\nsum(pingora_synced_routes) by (type)\n\n# Total routes across all types\nsum(pingora_synced_routes)\n</code></pre>"},{"location":"operations/metrics/#pingora_ingress_rules","title":"pingora_ingress_rules","text":"<p>Total ingress rules in proxy configuration.</p> <p>Type: Gauge</p> <p>Example:</p> <pre><code>pingora_ingress_rules\n</code></pre>"},{"location":"operations/metrics/#pingora_failed_backend_refs","title":"pingora_failed_backend_refs","text":"<p>Number of failed backend references by route type.</p> Label Description <code>type</code> Route type: <code>HTTPRoute</code>, <code>GRPCRoute</code> <p>Type: Gauge</p> <p>Example:</p> <pre><code># Alert on failed backends\nsum(pingora_failed_backend_refs) &gt; 0\n</code></pre>"},{"location":"operations/metrics/#pingora_sync_errors_total","title":"pingora_sync_errors_total","text":"<p>Total sync errors by type.</p> Label Description <code>error_type</code> Error category <p>Type: Counter</p> <p>Example:</p> <pre><code># Error rate per minute\nsum(rate(pingora_sync_errors_total[1m])) by (error_type)\n</code></pre>"},{"location":"operations/metrics/#ingress-build-metrics","title":"Ingress Build Metrics","text":""},{"location":"operations/metrics/#pingora_ingress_build_duration_seconds","title":"pingora_ingress_build_duration_seconds","text":"<p>Duration of ingress rule building.</p> Label Description <code>type</code> Route type: <code>HTTPRoute</code>, <code>GRPCRoute</code> <p>Type: Histogram</p> <p>Buckets: 0.001, 0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5 seconds</p> <p>Example:</p> <pre><code># Average build time by type\nsum(rate(pingora_ingress_build_duration_seconds_sum[5m])) by (type) /\nsum(rate(pingora_ingress_build_duration_seconds_count[5m])) by (type)\n</code></pre>"},{"location":"operations/metrics/#pingora_backend_ref_validation_total","title":"pingora_backend_ref_validation_total","text":"<p>Backend reference validation results.</p> Label Description <code>type</code> Route type: <code>HTTPRoute</code>, <code>GRPCRoute</code> <code>result</code> Validation result: <code>success</code>, <code>failure</code> <code>reason</code> Failure reason (if applicable) <p>Type: Counter</p> <p>Example:</p> <pre><code># Validation failure rate\nsum(rate(pingora_backend_ref_validation_total{result=\"failure\"}[5m])) by (reason)\n\n# Success rate\nsum(rate(pingora_backend_ref_validation_total{result=\"success\"}[5m])) /\nsum(rate(pingora_backend_ref_validation_total[5m]))\n</code></pre>"},{"location":"operations/metrics/#grpc-metrics","title":"gRPC Metrics","text":""},{"location":"operations/metrics/#pingora_grpc_duration_seconds","title":"pingora_grpc_duration_seconds","text":"<p>Duration of gRPC calls to Pingora proxy.</p> Label Description <code>method</code> gRPC method name <p>Type: Histogram</p> <p>Buckets: 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5 seconds</p> <p>Example:</p> <pre><code># 99th percentile gRPC latency\nhistogram_quantile(0.99,\n  sum(rate(pingora_grpc_duration_seconds_bucket[5m])) by (le, method)\n)\n</code></pre>"},{"location":"operations/metrics/#pingora_grpc_calls_total","title":"pingora_grpc_calls_total","text":"<p>Total gRPC calls to Pingora proxy.</p> Label Description <code>method</code> gRPC method name <code>status</code> Call status: <code>success</code>, <code>error</code> <p>Type: Counter</p> <p>Example:</p> <pre><code># Call rate by method and status\nsum(rate(pingora_grpc_calls_total[5m])) by (method, status)\n\n# Success rate\nsum(rate(pingora_grpc_calls_total{status=\"success\"}[5m])) /\nsum(rate(pingora_grpc_calls_total[5m]))\n</code></pre>"},{"location":"operations/metrics/#pingora_grpc_errors_total","title":"pingora_grpc_errors_total","text":"<p>Total gRPC errors by type.</p> Label Description <code>method</code> gRPC method name <code>error_type</code> Error category <p>Type: Counter</p> <p>Example:</p> <pre><code># Error rate by method\nsum(rate(pingora_grpc_errors_total[5m])) by (method, error_type)\n</code></pre>"},{"location":"operations/metrics/#controller-runtime-metrics","title":"Controller-Runtime Metrics","text":"<p>The controller also exposes standard controller-runtime metrics:</p>"},{"location":"operations/metrics/#controller_runtime_reconcile_total","title":"controller_runtime_reconcile_total","text":"<p>Total reconciliation attempts.</p> Label Description <code>controller</code> Controller name <code>result</code> <code>success</code>, <code>error</code>, <code>requeue</code>"},{"location":"operations/metrics/#controller_runtime_reconcile_time_seconds","title":"controller_runtime_reconcile_time_seconds","text":"<p>Time taken by reconciliation.</p> Label Description <code>controller</code> Controller name"},{"location":"operations/metrics/#workqueue_depth","title":"workqueue_depth","text":"<p>Current depth of the work queue.</p>"},{"location":"operations/metrics/#workqueue_adds_total","title":"workqueue_adds_total","text":"<p>Total elements added to the queue.</p>"},{"location":"operations/metrics/#recommended-alerts","title":"Recommended Alerts","text":"<pre><code>groups:\n  - name: pingora-gateway\n    rules:\n      - alert: PingoraSyncErrors\n        expr: increase(pingora_sync_errors_total[5m]) &gt; 5\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: \"Sync errors detected\"\n\n      - alert: PingoraGRPCErrors\n        expr: increase(pingora_grpc_errors_total[5m]) &gt; 10\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: \"gRPC communication errors\"\n\n      - alert: PingoraSyncSlow\n        expr: |\n          histogram_quantile(0.95,\n            sum(rate(pingora_sync_duration_seconds_bucket[5m])) by (le)\n          ) &gt; 10\n        for: 10m\n        labels:\n          severity: warning\n        annotations:\n          summary: \"Slow route synchronization\"\n\n      - alert: PingoraFailedBackends\n        expr: sum(pingora_failed_backend_refs) &gt; 0\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: \"Failed backend references detected\"\n</code></pre>"},{"location":"operations/metrics/#grafana-queries","title":"Grafana Queries","text":""},{"location":"operations/metrics/#key-dashboard-panels","title":"Key Dashboard Panels","text":"<pre><code># Routes Overview\nsum(pingora_synced_routes) by (type)\n\n# Sync Performance\nhistogram_quantile(0.95, sum(rate(pingora_sync_duration_seconds_bucket[5m])) by (le))\n\n# gRPC Success Rate\nsum(rate(pingora_grpc_calls_total{status=\"success\"}[5m])) /\nsum(rate(pingora_grpc_calls_total[5m])) * 100\n\n# Error Rate\nsum(rate(pingora_sync_errors_total[5m])) by (error_type)\n</code></pre>"},{"location":"operations/metrics/#next-steps","title":"Next Steps","text":"<ul> <li>Set up Monitoring with Prometheus and Grafana</li> <li>Review Troubleshooting for common issues</li> </ul>"},{"location":"operations/troubleshooting/","title":"Troubleshooting","text":"<p>Common issues and solutions for Pingora Gateway Controller.</p>"},{"location":"operations/troubleshooting/#diagnostic-commands","title":"Diagnostic Commands","text":""},{"location":"operations/troubleshooting/#check-component-status","title":"Check Component Status","text":"<pre><code># Controller pods\nkubectl get pods --namespace pingora-system \\\n  --selector app.kubernetes.io/name=pingora-gateway-controller\n\n# Proxy pods\nkubectl get pods --namespace pingora-system \\\n  --selector app.kubernetes.io/component=proxy\n\n# All resources\nkubectl get all --namespace pingora-system\n</code></pre>"},{"location":"operations/troubleshooting/#view-logs","title":"View Logs","text":"<pre><code># Controller logs\nkubectl logs --namespace pingora-system \\\n  --selector app.kubernetes.io/name=pingora-gateway-controller \\\n  --tail=100 --follow\n\n# Proxy logs\nkubectl logs --namespace pingora-system \\\n  --selector app.kubernetes.io/component=proxy \\\n  --tail=100 --follow\n</code></pre>"},{"location":"operations/troubleshooting/#check-events","title":"Check Events","text":"<pre><code>kubectl get events --namespace pingora-system --sort-by='.lastTimestamp'\n</code></pre>"},{"location":"operations/troubleshooting/#common-issues","title":"Common Issues","text":""},{"location":"operations/troubleshooting/#gatewayclass-not-accepted","title":"GatewayClass Not Accepted","text":"<p>Symptom: GatewayClass shows <code>Accepted: False</code></p> <pre><code>kubectl get gatewayclass pingora\n</code></pre> <p>Causes:</p> <ol> <li>Controller not running</li> <li>Wrong controller name in GatewayClass</li> </ol> <p>Solution:</p> <pre><code># Verify controller is running\nkubectl get pods --namespace pingora-system\n\n# Check GatewayClass spec\nkubectl get gatewayclass pingora --output yaml\n\n# Controller name should match\ncontrollerName: pingora.k8s.lex.la/gateway-controller\n</code></pre>"},{"location":"operations/troubleshooting/#gateway-not-programmed","title":"Gateway Not Programmed","text":"<p>Symptom: Gateway shows <code>Programmed: False</code></p> <p>Causes:</p> <ol> <li>GatewayClass not accepted</li> <li>PingoraConfig not found or invalid</li> <li>Unable to connect to proxy</li> </ol> <p>Solution:</p> <pre><code># Check GatewayClass status\nkubectl get gatewayclass pingora\n\n# Check PingoraConfig\nkubectl get pingoraconfig --output wide\n\n# Verify proxy is reachable\nkubectl exec -it deployment/pingora-gateway-controller \\\n  --namespace pingora-system -- \\\n  nc -zv pingora-gateway-controller-proxy 50051\n</code></pre>"},{"location":"operations/troubleshooting/#httproute-not-accepted","title":"HTTPRoute Not Accepted","text":"<p>Symptom: HTTPRoute shows <code>Accepted: False</code></p> <pre><code>kubectl get httproute my-route --output yaml\n</code></pre> <p>Causes:</p> <ol> <li>Gateway not found (wrong name or namespace)</li> <li>GatewayClass not accepted</li> <li>Backend service not found</li> </ol> <p>Solution:</p> <pre><code># Check parent reference\nkubectl get httproute my-route --output jsonpath='{.spec.parentRefs}'\n\n# Verify Gateway exists\nkubectl get gateway --namespace pingora-system\n\n# Check backend service\nkubectl get service my-backend --namespace default\n</code></pre>"},{"location":"operations/troubleshooting/#cross-namespace-reference-failed","title":"Cross-Namespace Reference Failed","text":"<p>Symptom: <code>ResolvedRefs: False</code> with reason <code>RefNotPermitted</code></p> <p>Causes:</p> <ol> <li>ReferenceGrant missing</li> <li>ReferenceGrant in wrong namespace</li> <li>ReferenceGrant doesn't match source namespace</li> </ol> <p>Solution:</p> <pre><code># Check for ReferenceGrant in target namespace\nkubectl get referencegrant --namespace target-namespace\n\n# Verify ReferenceGrant allows source namespace\nkubectl get referencegrant allow-grant --namespace target-namespace --output yaml\n</code></pre>"},{"location":"operations/troubleshooting/#routes-not-syncing","title":"Routes Not Syncing","text":"<p>Symptom: Routes accepted but traffic not routing</p> <p>Causes:</p> <ol> <li>Proxy not receiving configuration</li> <li>gRPC connection issues</li> <li>Backend service has no endpoints</li> </ol> <p>Solution:</p> <pre><code># Check PingoraConfig status\nkubectl get pingoraconfig --output yaml\n\n# Look for sync errors in controller logs\nkubectl logs --namespace pingora-system \\\n  --selector app.kubernetes.io/name=pingora-gateway-controller | grep -i error\n\n# Verify backend has endpoints\nkubectl get endpoints my-backend\n</code></pre>"},{"location":"operations/troubleshooting/#proxy-connection-refused","title":"Proxy Connection Refused","text":"<p>Symptom: Controller logs show gRPC connection errors</p> <p>Causes:</p> <ol> <li>Proxy pods not running</li> <li>Wrong address in PingoraConfig</li> <li>Network policy blocking traffic</li> </ol> <p>Solution:</p> <pre><code># Check proxy pods\nkubectl get pods --namespace pingora-system \\\n  --selector app.kubernetes.io/component=proxy\n\n# Verify PingoraConfig address\nkubectl get pingoraconfig --output jsonpath='{.items[*].spec.address}'\n\n# Test connectivity\nkubectl exec -it deployment/pingora-gateway-controller \\\n  --namespace pingora-system -- \\\n  nc -zv pingora-gateway-controller-proxy.pingora-system.svc.cluster.local 50051\n</code></pre>"},{"location":"operations/troubleshooting/#high-latency","title":"High Latency","text":"<p>Symptom: Slow request processing</p> <p>Causes:</p> <ol> <li>Proxy resource constraints</li> <li>Backend service slow</li> <li>Too many routes causing slow sync</li> </ol> <p>Solution:</p> <pre><code># Check proxy resource usage\nkubectl top pods --namespace pingora-system \\\n  --selector app.kubernetes.io/component=proxy\n\n# Check sync duration metrics\ncurl http://controller:8080/metrics | grep pingora_sync_duration\n\n# Consider increasing proxy replicas/resources\n</code></pre>"},{"location":"operations/troubleshooting/#debug-mode","title":"Debug Mode","text":"<p>Enable debug logging for more detailed output:</p> <pre><code># In Helm values\ncontroller:\n  logLevel: \"debug\"\n\nproxy:\n  logLevel: \"debug\"\n</code></pre> <p>Or patch the deployment:</p> <pre><code>kubectl set env deployment/pingora-gateway-controller \\\n  --namespace pingora-system \\\n  PINGORA_LOG_LEVEL=debug\n</code></pre>"},{"location":"operations/troubleshooting/#collecting-debug-information","title":"Collecting Debug Information","text":"<p>For bug reports, collect:</p> <pre><code># Version information\nkubectl get deployment pingora-gateway-controller \\\n  --namespace pingora-system \\\n  --output jsonpath='{.spec.template.spec.containers[0].image}'\n\n# Resource status\nkubectl get gatewayclass,gateway,httproute,grpcroute,pingoraconfig \\\n  --all-namespaces --output yaml &gt; resources.yaml\n\n# Controller logs\nkubectl logs --namespace pingora-system \\\n  --selector app.kubernetes.io/name=pingora-gateway-controller \\\n  --tail=1000 &gt; controller.log\n\n# Proxy logs\nkubectl logs --namespace pingora-system \\\n  --selector app.kubernetes.io/component=proxy \\\n  --tail=1000 &gt; proxy.log\n\n# Events\nkubectl get events --namespace pingora-system \\\n  --sort-by='.lastTimestamp' &gt; events.txt\n</code></pre>"},{"location":"operations/troubleshooting/#getting-help","title":"Getting Help","text":"<p>If issues persist:</p> <ol> <li>Check GitHub Issues</li> <li>Create a new issue with debug information</li> <li>Include reproduction steps and expected behavior</li> </ol>"},{"location":"operations/troubleshooting/#next-steps","title":"Next Steps","text":"<ul> <li>Review Metrics for monitoring</li> <li>Check Configuration for settings</li> </ul>"},{"location":"reference/","title":"Reference","text":"<p>Complete reference documentation for Pingora Gateway Controller.</p>"},{"location":"reference/#sections","title":"Sections","text":"<ul> <li> <p> Helm Chart</p> <p>Complete Helm chart reference with all available values and options.</p> <p> Helm Chart</p> </li> <li> <p> CRD Reference</p> <p>Complete specification of the PingoraConfig Custom Resource Definition.</p> <p> CRD Reference</p> </li> <li> <p> Security</p> <p>Security considerations, best practices, and hardening guidelines.</p> <p> Security</p> </li> </ul>"},{"location":"reference/#quick-links","title":"Quick Links","text":""},{"location":"reference/#api-versions","title":"API Versions","text":"Resource API Version PingoraConfig <code>pingora.k8s.lex.la/v1alpha1</code> GatewayClass <code>gateway.networking.k8s.io/v1</code> Gateway <code>gateway.networking.k8s.io/v1</code> HTTPRoute <code>gateway.networking.k8s.io/v1</code> GRPCRoute <code>gateway.networking.k8s.io/v1</code>"},{"location":"reference/#container-images","title":"Container Images","text":"Component Image Controller <code>ghcr.io/lexfrei/pingora-gateway-controller</code> Proxy <code>ghcr.io/lexfrei/pingora-proxy</code>"},{"location":"reference/#default-ports","title":"Default Ports","text":"Port Purpose 80 HTTP traffic (proxy) 50051 gRPC (proxy) 8080 Metrics (controller) 8081 Health checks"},{"location":"reference/#next-steps","title":"Next Steps","text":"<ul> <li>Review Helm Chart configuration</li> <li>Check CRD Reference for custom resources</li> <li>Read Security best practices</li> </ul>"},{"location":"reference/crd-reference/","title":"CRD Reference","text":"<p>Complete specification of the PingoraConfig Custom Resource Definition.</p>"},{"location":"reference/crd-reference/#pingoraconfig","title":"PingoraConfig","text":"<p>PingoraConfig is a cluster-scoped resource that configures the connection between the controller and Pingora proxy.</p>"},{"location":"reference/crd-reference/#api-version","title":"API Version","text":"<pre><code>apiVersion: pingora.k8s.lex.la/v1alpha1\nkind: PingoraConfig\n</code></pre>"},{"location":"reference/crd-reference/#metadata","title":"Metadata","text":"Field Type Description <code>name</code> string Resource name (cluster-scoped) <code>labels</code> map Standard Kubernetes labels <code>annotations</code> map Standard Kubernetes annotations"},{"location":"reference/crd-reference/#spec","title":"Spec","text":""},{"location":"reference/crd-reference/#specaddress","title":"spec.address","text":"<p>Required. The gRPC endpoint address of the Pingora proxy.</p> Field Type Required Description <code>address</code> string Yes Format: <code>host:port</code> <p>Example:</p> <pre><code>spec:\n  address: \"pingora-proxy.pingora-system.svc.cluster.local:50051\"\n</code></pre>"},{"location":"reference/crd-reference/#spectls","title":"spec.tls","text":"<p>Optional TLS configuration for the gRPC connection.</p> Field Type Default Description <code>enabled</code> boolean <code>false</code> Enable TLS <code>secretRef</code> object - Reference to TLS Secret <code>insecureSkipVerify</code> boolean <code>false</code> Skip certificate verification <code>serverName</code> string - Override server name"},{"location":"reference/crd-reference/#spectlssecretref","title":"spec.tls.secretRef","text":"Field Type Required Description <code>name</code> string Yes Secret name <code>namespace</code> string No Secret namespace <p>The referenced Secret must contain:</p> <ul> <li><code>tls.crt</code> - TLS certificate</li> <li><code>tls.key</code> - TLS private key</li> <li><code>ca.crt</code> - CA certificate (optional)</li> </ul> <p>Example:</p> <pre><code>spec:\n  tls:\n    enabled: true\n    secretRef:\n      name: pingora-mtls\n      namespace: pingora-system\n    serverName: \"pingora-proxy\"\n</code></pre>"},{"location":"reference/crd-reference/#specconnection","title":"spec.connection","text":"<p>Optional connection parameters for gRPC.</p> Field Type Default Min Description <code>connectTimeoutSeconds</code> int32 <code>5</code> 1 Connection timeout <code>requestTimeoutSeconds</code> int32 <code>30</code> 1 Request timeout <code>keepaliveTimeSeconds</code> int32 <code>30</code> 10 Keepalive interval <code>maxRetries</code> int32 <code>3</code> 0 Max retry attempts <code>retryBackoffMs</code> int32 <code>1000</code> 100 Retry backoff (ms) <p>Example:</p> <pre><code>spec:\n  connection:\n    connectTimeoutSeconds: 10\n    requestTimeoutSeconds: 60\n    keepaliveTimeSeconds: 15\n    maxRetries: 5\n    retryBackoffMs: 2000\n</code></pre>"},{"location":"reference/crd-reference/#status","title":"Status","text":"<p>The controller updates the status subresource.</p> Field Type Description <code>conditions</code> []Condition Standard Kubernetes conditions <code>connected</code> boolean Connection established <code>lastSyncTime</code> Time Last successful sync <code>configVersion</code> uint64 Current config version"},{"location":"reference/crd-reference/#conditions","title":"Conditions","text":"Type Reason Description <code>Ready</code> <code>Connected</code> Successfully connected to proxy <code>Ready</code> <code>ConnectionFailed</code> Failed to connect <code>Ready</code> <code>ConfigurationInvalid</code> Invalid configuration"},{"location":"reference/crd-reference/#short-name","title":"Short Name","text":"<p>The CRD registers the short name <code>pgconfig</code>:</p> <pre><code>kubectl get pgconfig\n</code></pre>"},{"location":"reference/crd-reference/#print-columns","title":"Print Columns","text":"Name Path Description Address <code>.spec.address</code> Proxy address TLS <code>.spec.tls.enabled</code> TLS enabled Connected <code>.status.connected</code> Connection status Age <code>.metadata.creationTimestamp</code> Resource age"},{"location":"reference/crd-reference/#complete-example","title":"Complete Example","text":"<pre><code>apiVersion: pingora.k8s.lex.la/v1alpha1\nkind: PingoraConfig\nmetadata:\n  name: pingora-config\n  labels:\n    app.kubernetes.io/name: pingora-gateway-controller\n    app.kubernetes.io/managed-by: Helm\nspec:\n  # Required: Proxy gRPC address\n  address: \"pingora-proxy.pingora-system.svc.cluster.local:50051\"\n\n  # Optional: TLS configuration\n  tls:\n    enabled: true\n    secretRef:\n      name: pingora-mtls\n      namespace: pingora-system\n    insecureSkipVerify: false\n    serverName: \"pingora-proxy\"\n\n  # Optional: Connection parameters\n  connection:\n    connectTimeoutSeconds: 5\n    requestTimeoutSeconds: 30\n    keepaliveTimeSeconds: 30\n    maxRetries: 3\n    retryBackoffMs: 1000\n</code></pre>"},{"location":"reference/crd-reference/#gatewayclass-integration","title":"GatewayClass Integration","text":"<p>PingoraConfig is referenced by GatewayClass via <code>parametersRef</code>:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1\nkind: GatewayClass\nmetadata:\n  name: pingora\nspec:\n  controllerName: pingora.k8s.lex.la/gateway-controller\n  parametersRef:\n    group: pingora.k8s.lex.la\n    kind: PingoraConfig\n    name: pingora-config\n</code></pre>"},{"location":"reference/crd-reference/#validation","title":"Validation","text":"<p>The CRD includes validation rules:</p> Field Validation <code>spec.address</code> Required, min length 1 <code>spec.tls.secretRef.name</code> Required if secretRef specified, min length 1 <code>spec.connection.connectTimeoutSeconds</code> Minimum 1 <code>spec.connection.requestTimeoutSeconds</code> Minimum 1 <code>spec.connection.keepaliveTimeSeconds</code> Minimum 10 <code>spec.connection.maxRetries</code> Minimum 0 <code>spec.connection.retryBackoffMs</code> Minimum 100"},{"location":"reference/crd-reference/#watching-pingoraconfig","title":"Watching PingoraConfig","text":"<p>The controller watches PingoraConfig resources and reconciles when:</p> <ul> <li>PingoraConfig is created, updated, or deleted</li> <li>Referenced Secret changes (if TLS enabled)</li> <li>GatewayClass parametersRef changes</li> </ul>"},{"location":"reference/crd-reference/#next-steps","title":"Next Steps","text":"<ul> <li>Review Helm Chart for deployment options</li> <li>Check Security best practices</li> </ul>"},{"location":"reference/helm-chart/","title":"Helm Chart Reference","text":"<p>Complete reference for the Pingora Gateway Controller Helm chart.</p>"},{"location":"reference/helm-chart/#installation","title":"Installation","text":"<pre><code>helm install pingora-gateway-controller \\\n  oci://ghcr.io/lexfrei/pingora-gateway-controller/chart \\\n  --namespace pingora-system \\\n  --create-namespace\n</code></pre>"},{"location":"reference/helm-chart/#chart-info","title":"Chart Info","text":"Property Value Chart Name <code>pingora-gateway-controller</code> Chart Type application Home https://github.com/lexfrei/pingora-gateway-controller"},{"location":"reference/helm-chart/#values-reference","title":"Values Reference","text":""},{"location":"reference/helm-chart/#global","title":"Global","text":"Key Type Default Description <code>nameOverride</code> string <code>\"\"</code> Override chart name <code>fullnameOverride</code> string <code>\"\"</code> Override full release name <code>imagePullSecrets</code> list <code>[]</code> Image pull secrets"},{"location":"reference/helm-chart/#controller-image","title":"Controller Image","text":"Key Type Default Description <code>image.repository</code> string <code>ghcr.io/lexfrei/pingora-gateway-controller</code> Image repository <code>image.pullPolicy</code> string <code>IfNotPresent</code> Image pull policy <code>image.tag</code> string <code>\"\"</code> Image tag (defaults to appVersion)"},{"location":"reference/helm-chart/#controller-settings","title":"Controller Settings","text":"Key Type Default Description <code>controller.gatewayClassName</code> string <code>pingora</code> GatewayClass name to watch <code>controller.controllerName</code> string <code>pingora.k8s.lex.la/gateway-controller</code> Controller identifier <code>controller.clusterDomain</code> string <code>\"\"</code> Cluster domain (auto-detected) <code>controller.logLevel</code> string <code>info</code> Log level: debug, info, warn, error <code>controller.logFormat</code> string <code>json</code> Log format: json, text"},{"location":"reference/helm-chart/#leader-election","title":"Leader Election","text":"Key Type Default Description <code>leaderElection.enabled</code> bool <code>false</code> Enable leader election <code>leaderElection.namespace</code> string <code>\"\"</code> Lease namespace <code>leaderElection.leaseName</code> string <code>pingora-gateway-controller-leader</code> Lease name"},{"location":"reference/helm-chart/#pingoraconfig","title":"PingoraConfig","text":"Key Type Default Description <code>pingoraConfig.create</code> bool <code>true</code> Create PingoraConfig resource <code>pingoraConfig.name</code> string <code>\"\"</code> Config name (defaults to release name) <code>pingoraConfig.address</code> string <code>\"\"</code> Proxy gRPC address (auto-configured)"},{"location":"reference/helm-chart/#pingoraconfig-tls","title":"PingoraConfig TLS","text":"Key Type Default Description <code>pingoraConfig.tls.enabled</code> bool <code>false</code> Enable TLS <code>pingoraConfig.tls.secretRef.name</code> string <code>\"\"</code> TLS Secret name <code>pingoraConfig.tls.secretRef.namespace</code> string <code>\"\"</code> TLS Secret namespace <code>pingoraConfig.tls.insecureSkipVerify</code> bool <code>false</code> Skip TLS verification <code>pingoraConfig.tls.serverName</code> string <code>\"\"</code> TLS server name override"},{"location":"reference/helm-chart/#pingoraconfig-connection","title":"PingoraConfig Connection","text":"Key Type Default Description <code>pingoraConfig.connection.connectTimeoutSeconds</code> int <code>5</code> Connection timeout <code>pingoraConfig.connection.requestTimeoutSeconds</code> int <code>30</code> Request timeout <code>pingoraConfig.connection.keepaliveTimeSeconds</code> int <code>30</code> Keepalive interval <code>pingoraConfig.connection.maxRetries</code> int <code>3</code> Max retry attempts <code>pingoraConfig.connection.retryBackoffMs</code> int <code>1000</code> Retry backoff (ms)"},{"location":"reference/helm-chart/#proxy","title":"Proxy","text":"Key Type Default Description <code>proxy.enabled</code> bool <code>true</code> Deploy proxy <code>proxy.replicaCount</code> int <code>2</code> Proxy replicas <code>proxy.image.repository</code> string <code>ghcr.io/lexfrei/pingora-proxy</code> Proxy image <code>proxy.image.pullPolicy</code> string <code>IfNotPresent</code> Pull policy <code>proxy.image.tag</code> string <code>\"\"</code> Image tag <code>proxy.logLevel</code> string <code>info</code> Log level <code>proxy.service.type</code> string <code>ClusterIP</code> Service type <code>proxy.service.annotations</code> object <code>{}</code> Service annotations"},{"location":"reference/helm-chart/#proxy-resources","title":"Proxy Resources","text":"Key Type Default Description <code>proxy.resources.limits.cpu</code> string <code>500m</code> CPU limit <code>proxy.resources.limits.memory</code> string <code>512Mi</code> Memory limit <code>proxy.resources.requests.cpu</code> string <code>100m</code> CPU request <code>proxy.resources.requests.memory</code> string <code>128Mi</code> Memory request"},{"location":"reference/helm-chart/#replica-count","title":"Replica Count","text":"Key Type Default Description <code>replicaCount</code> int <code>1</code> Controller replicas"},{"location":"reference/helm-chart/#resources","title":"Resources","text":"Key Type Default Description <code>resources.limits.cpu</code> string <code>200m</code> CPU limit <code>resources.limits.memory</code> string <code>256Mi</code> Memory limit <code>resources.requests.cpu</code> string <code>100m</code> CPU request <code>resources.requests.memory</code> string <code>128Mi</code> Memory request"},{"location":"reference/helm-chart/#security-context","title":"Security Context","text":"Key Type Default Description <code>podSecurityContext.runAsNonRoot</code> bool <code>true</code> Run as non-root <code>podSecurityContext.runAsUser</code> int <code>65534</code> User ID <code>podSecurityContext.seccompProfile.type</code> string <code>RuntimeDefault</code> Seccomp profile <code>securityContext.allowPrivilegeEscalation</code> bool <code>false</code> Disable privilege escalation <code>securityContext.readOnlyRootFilesystem</code> bool <code>true</code> Read-only filesystem <code>securityContext.capabilities.drop</code> list <code>[ALL]</code> Drop all capabilities"},{"location":"reference/helm-chart/#service-account","title":"Service Account","text":"Key Type Default Description <code>serviceAccount.annotations</code> object <code>{}</code> SA annotations <code>serviceAccount.name</code> string <code>\"\"</code> SA name"},{"location":"reference/helm-chart/#service","title":"Service","text":"Key Type Default Description <code>service.type</code> string <code>ClusterIP</code> Service type <code>service.metricsPort</code> int <code>8080</code> Metrics port <code>service.healthPort</code> int <code>8081</code> Health port <code>service.annotations</code> object <code>{}</code> Annotations"},{"location":"reference/helm-chart/#servicemonitor","title":"ServiceMonitor","text":"Key Type Default Description <code>serviceMonitor.enabled</code> bool <code>false</code> Create ServiceMonitor <code>serviceMonitor.interval</code> string <code>\"\"</code> Scrape interval <code>serviceMonitor.labels</code> object <code>{}</code> Additional labels"},{"location":"reference/helm-chart/#health-probes","title":"Health Probes","text":"Key Type Default Description <code>healthProbes.startupProbe.enabled</code> bool <code>true</code> Enable startup probe <code>healthProbes.startupProbe.initialDelaySeconds</code> int <code>0</code> Initial delay <code>healthProbes.startupProbe.periodSeconds</code> int <code>5</code> Period <code>healthProbes.startupProbe.failureThreshold</code> int <code>12</code> Failure threshold <code>healthProbes.livenessProbe.enabled</code> bool <code>true</code> Enable liveness <code>healthProbes.livenessProbe.initialDelaySeconds</code> int <code>15</code> Initial delay <code>healthProbes.livenessProbe.periodSeconds</code> int <code>20</code> Period <code>healthProbes.readinessProbe.enabled</code> bool <code>true</code> Enable readiness <code>healthProbes.readinessProbe.initialDelaySeconds</code> int <code>5</code> Initial delay <code>healthProbes.readinessProbe.periodSeconds</code> int <code>10</code> Period"},{"location":"reference/helm-chart/#pod-disruption-budget","title":"Pod Disruption Budget","text":"Key Type Default Description <code>podDisruptionBudget.enabled</code> bool <code>false</code> Enable PDB <code>podDisruptionBudget.minAvailable</code> int <code>1</code> Min available <code>podDisruptionBudget.maxUnavailable</code> - <code>null</code> Max unavailable"},{"location":"reference/helm-chart/#network-policy","title":"Network Policy","text":"Key Type Default Description <code>networkPolicy.enabled</code> bool <code>false</code> Enable NetworkPolicy <code>networkPolicy.ingress.from</code> list <code>[]</code> Ingress sources <code>networkPolicy.pingoraProxy.port</code> int <code>50051</code> Proxy gRPC port"},{"location":"reference/helm-chart/#gatewayclass","title":"GatewayClass","text":"Key Type Default Description <code>gatewayClass.create</code> bool <code>true</code> Create GatewayClass"},{"location":"reference/helm-chart/#scheduling","title":"Scheduling","text":"Key Type Default Description <code>nodeSelector</code> object <code>{}</code> Node selector <code>tolerations</code> list <code>[]</code> Tolerations <code>affinity</code> object <code>{}</code> Affinity rules <code>topologySpreadConstraints</code> list <code>[]</code> Topology spread <code>priorityClassName</code> string <code>\"\"</code> Priority class"},{"location":"reference/helm-chart/#example-values-files","title":"Example Values Files","text":""},{"location":"reference/helm-chart/#minimal","title":"Minimal","text":"<pre><code># minimal-values.yaml\ncontroller:\n  logLevel: info\n</code></pre>"},{"location":"reference/helm-chart/#production","title":"Production","text":"<pre><code># production-values.yaml\nreplicaCount: 2\n\nleaderElection:\n  enabled: true\n\ncontroller:\n  logLevel: info\n  logFormat: json\n\nproxy:\n  enabled: true\n  replicaCount: 3\n  resources:\n    limits:\n      cpu: 2\n      memory: 2Gi\n    requests:\n      cpu: 500m\n      memory: 512Mi\n\nresources:\n  limits:\n    cpu: 500m\n    memory: 512Mi\n  requests:\n    cpu: 200m\n    memory: 256Mi\n\npodDisruptionBudget:\n  enabled: true\n  minAvailable: 1\n\nserviceMonitor:\n  enabled: true\n  labels:\n    release: prometheus\n\naffinity:\n  podAntiAffinity:\n    preferredDuringSchedulingIgnoredDuringExecution:\n      - weight: 100\n        podAffinityTerm:\n          labelSelector:\n            matchLabels:\n              app.kubernetes.io/name: pingora-gateway-controller\n          topologyKey: kubernetes.io/hostname\n</code></pre>"},{"location":"reference/helm-chart/#with-tls","title":"With TLS","text":"<pre><code># tls-values.yaml\npingoraConfig:\n  tls:\n    enabled: true\n    secretRef:\n      name: pingora-tls\n      namespace: pingora-system\n    serverName: pingora-proxy\n</code></pre>"},{"location":"reference/helm-chart/#next-steps","title":"Next Steps","text":"<ul> <li>Review CRD Reference</li> <li>Check Security best practices</li> </ul>"},{"location":"reference/security/","title":"Security","text":"<p>Security considerations and best practices for Pingora Gateway Controller.</p>"},{"location":"reference/security/#container-security","title":"Container Security","text":""},{"location":"reference/security/#default-security-context","title":"Default Security Context","text":"<p>The Helm chart applies secure defaults:</p> <pre><code>podSecurityContext:\n  runAsNonRoot: true\n  runAsUser: 65534\n  seccompProfile:\n    type: RuntimeDefault\n\nsecurityContext:\n  allowPrivilegeEscalation: false\n  readOnlyRootFilesystem: true\n  capabilities:\n    drop:\n      - ALL\n</code></pre>"},{"location":"reference/security/#pod-security-standards","title":"Pod Security Standards","text":"<p>The controller is compatible with:</p> <ul> <li>Restricted Pod Security Standard (most secure)</li> <li>Baseline Pod Security Standard</li> <li>Privileged Pod Security Standard</li> </ul> <p>To enforce restricted mode:</p> <pre><code>kubectl label namespace pingora-system \\\n  pod-security.kubernetes.io/enforce=restricted\n</code></pre>"},{"location":"reference/security/#rbac","title":"RBAC","text":""},{"location":"reference/security/#controller-permissions","title":"Controller Permissions","text":"<p>The controller requires minimal RBAC permissions:</p> Resource Verbs Purpose GatewayClass get, list, watch Watch GatewayClass GatewayClass/status update, patch Update status Gateway get, list, watch Watch Gateway Gateway/status update, patch Update status HTTPRoute get, list, watch Watch HTTPRoute HTTPRoute/status update, patch Update status GRPCRoute get, list, watch Watch GRPCRoute GRPCRoute/status update, patch Update status ReferenceGrant get, list, watch Cross-namespace refs PingoraConfig get, list, watch Configuration PingoraConfig/status update, patch Update status Service get, list, watch Backend resolution Endpoints get, list, watch Backend health Secret get, list, watch TLS certificates Event create, patch Event recording Lease get, create, update Leader election"},{"location":"reference/security/#limiting-permissions","title":"Limiting Permissions","text":"<p>For additional security, consider:</p> <ol> <li>Namespace-scoped: Configure controller to watch specific namespaces</li> <li>Custom ClusterRole: Remove unused permissions</li> <li>Audit logging: Enable Kubernetes audit logs</li> </ol>"},{"location":"reference/security/#network-security","title":"Network Security","text":""},{"location":"reference/security/#network-policies","title":"Network Policies","text":"<p>Enable NetworkPolicy in Helm values:</p> <pre><code>networkPolicy:\n  enabled: true\n  ingress:\n    from:\n      - namespaceSelector:\n          matchLabels:\n            name: monitoring\n  pingoraProxy:\n    port: 50051\n    namespaceSelector:\n      matchLabels:\n        name: pingora-system\n    podSelector:\n      matchLabels:\n        app.kubernetes.io/component: proxy\n</code></pre>"},{"location":"reference/security/#minimal-network-access","title":"Minimal Network Access","text":"<p>The controller needs:</p> Direction Target Port Purpose Egress Kubernetes API 443 Watch resources Egress Pingora Proxy 50051 gRPC sync Ingress Prometheus 8080 Metrics scraping Ingress Kubelet 8081 Health probes"},{"location":"reference/security/#tls-configuration","title":"TLS Configuration","text":""},{"location":"reference/security/#controller-to-proxy-communication","title":"Controller to Proxy Communication","text":"<p>Enable TLS for gRPC communication:</p> <pre><code>pingoraConfig:\n  tls:\n    enabled: true\n    secretRef:\n      name: controller-mtls\n      namespace: pingora-system\n</code></pre>"},{"location":"reference/security/#certificate-requirements","title":"Certificate Requirements","text":"<ul> <li>Use certificates from a trusted CA</li> <li>Enable mutual TLS (mTLS) for production</li> <li>Rotate certificates regularly</li> <li>Monitor certificate expiration</li> </ul>"},{"location":"reference/security/#secret-management","title":"Secret Management","text":"<p>For production, use external secret management:</p> <pre><code>apiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: controller-mtls\n  namespace: pingora-system\nspec:\n  refreshInterval: 1h\n  secretStoreRef:\n    name: vault\n    kind: ClusterSecretStore\n  target:\n    name: controller-mtls\n  data:\n    - secretKey: tls.crt\n      remoteRef:\n        key: pingora/controller/cert\n    - secretKey: tls.key\n      remoteRef:\n        key: pingora/controller/key\n    - secretKey: ca.crt\n      remoteRef:\n        key: pingora/ca/cert\n</code></pre>"},{"location":"reference/security/#image-security","title":"Image Security","text":""},{"location":"reference/security/#image-verification","title":"Image Verification","text":"<p>Verify container images before deployment:</p> <pre><code># Check image digest\npodman pull ghcr.io/lexfrei/pingora-gateway-controller:latest\npodman inspect --format='{{.Digest}}' ghcr.io/lexfrei/pingora-gateway-controller:latest\n</code></pre>"},{"location":"reference/security/#image-pinning","title":"Image Pinning","text":"<p>Pin images to specific digests:</p> <pre><code>image:\n  repository: ghcr.io/lexfrei/pingora-gateway-controller\n  tag: v0.1.0@sha256:abc123...\n</code></pre>"},{"location":"reference/security/#vulnerability-scanning","title":"Vulnerability Scanning","text":"<p>Scan images regularly:</p> <pre><code>trivy image ghcr.io/lexfrei/pingora-gateway-controller:latest\n</code></pre>"},{"location":"reference/security/#secrets-management","title":"Secrets Management","text":""},{"location":"reference/security/#sensitive-data","title":"Sensitive Data","text":"<p>The controller may access:</p> <ul> <li>TLS certificates for proxy communication</li> <li>Kubernetes API server credentials (via ServiceAccount)</li> </ul>"},{"location":"reference/security/#best-practices","title":"Best Practices","text":"<ol> <li>Limit Secret access: Only grant access to required Secrets</li> <li>Encrypt at rest: Enable Kubernetes Secret encryption</li> <li>Audit access: Monitor Secret access patterns</li> <li>Rotate regularly: Implement certificate/token rotation</li> </ol>"},{"location":"reference/security/#gateway-api-security","title":"Gateway API Security","text":""},{"location":"reference/security/#referencegrant","title":"ReferenceGrant","text":"<p>Use ReferenceGrant to control cross-namespace access:</p> <pre><code>apiVersion: gateway.networking.k8s.io/v1beta1\nkind: ReferenceGrant\nmetadata:\n  name: allow-specific-routes\n  namespace: backend\nspec:\n  from:\n    - group: gateway.networking.k8s.io\n      kind: HTTPRoute\n      namespace: frontend  # Only frontend namespace\n  to:\n    - group: \"\"\n      kind: Service\n</code></pre>"},{"location":"reference/security/#route-isolation","title":"Route Isolation","text":"<p>Consider namespace-based isolation:</p> <ul> <li>Separate Gateway per tenant</li> <li>Strict ReferenceGrant policies</li> <li>NetworkPolicy per namespace</li> </ul>"},{"location":"reference/security/#monitoring-and-alerting","title":"Monitoring and Alerting","text":""},{"location":"reference/security/#security-related-alerts","title":"Security-Related Alerts","text":"<p>Monitor for:</p> <pre><code># Unexpected permission errors\n- alert: PingoraRBACErrors\n  expr: increase(controller_runtime_reconcile_total{result=\"error\"}[5m]) &gt; 10\n  annotations:\n    summary: \"Possible RBAC misconfiguration\"\n\n# TLS connection failures\n- alert: PingoraTLSErrors\n  expr: increase(pingora_grpc_errors_total{error_type=\"tls\"}[5m]) &gt; 0\n  annotations:\n    summary: \"TLS connection errors\"\n</code></pre>"},{"location":"reference/security/#audit-logging","title":"Audit Logging","text":"<p>Enable Kubernetes audit logging for:</p> <ul> <li>Secret access</li> <li>ReferenceGrant changes</li> <li>Gateway/Route modifications</li> </ul>"},{"location":"reference/security/#hardening-checklist","title":"Hardening Checklist","text":"<ul> <li> Run as non-root user (default)</li> <li> Enable seccomp profile (default)</li> <li> Drop all capabilities (default)</li> <li> Read-only filesystem (default)</li> <li> Enable NetworkPolicy</li> <li> Enable TLS for gRPC</li> <li> Pin container images</li> <li> Scan images for vulnerabilities</li> <li> Enable Kubernetes audit logging</li> <li> Use external secret management</li> <li> Apply restrictive RBAC</li> <li> Monitor security events</li> </ul>"},{"location":"reference/security/#reporting-security-issues","title":"Reporting Security Issues","text":"<p>Report security vulnerabilities to:</p> <ul> <li>Email: security@lex.la</li> <li>GitHub Security Advisories</li> </ul> <p>Do not report security issues in public GitHub issues.</p>"},{"location":"reference/security/#next-steps","title":"Next Steps","text":"<ul> <li>Review Helm Chart security settings</li> <li>Check CRD Reference for TLS configuration</li> </ul>"}]}